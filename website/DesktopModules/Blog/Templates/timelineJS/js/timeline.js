/*
	TimelineJS
	Version 2.17
	Designed and built by Zach Wise at VéritéCo

	This Source Code Form is subject to the terms of the Mozilla Public
	License, v. 2.0. If a copy of the MPL was not distributed with this
	file, You can obtain one at http://mozilla.org/MPL/2.0/.
	
*/
/*
	StoryJS
	Designed and built by Zach Wise at VéritéCo

	This Source Code Form is subject to the terms of the Mozilla Public
	License, v. 2.0. If a copy of the MPL was not distributed with this
	file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/
(function(){var b=false,a=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(f){var c=this.prototype;b=true;var g=new this();b=false;for(var e in f){g[e]=typeof f[e]=="function"&&typeof c[e]=="function"&&a.test(f[e])?(function(j,h){return function(){var l=this._super;this._super=c[j];var k=h.apply(this,arguments);this._super=l;return k}})(e,f[e]):f[e]}function d(){if(!b&&this.init){this.init.apply(this,arguments)}}d.prototype=g;d.prototype.constructor=d;d.extend=arguments.callee;return d}})();var global=(function(){return this||(1,eval)("this")}());if(typeof VMM=="undefined"){var VMM=Class.extend({});VMM.debug=true;VMM.master_config=({init:function(){return this},sizes:{api:{width:0,height:0}},vp:"Pellentesque nibh felis, eleifend id, commodo in, interdum vitae, leo",api_keys_master:{flickr:"RAIvxHY4hE/Elm5cieh4X5ptMyDpj7MYIxziGxi0WGCcy1s+yr7rKQ==",google:"uQKadH1VMlCsp560gN2aOiMz4evWkl1s34yryl3F/9FJOsn+/948CbBUvKLN46U=",twitter:""},timers:{api:7000},api:{pushques:[]},twitter:{active:false,array:[],api_loaded:false,que:[]},flickr:{active:false,array:[],api_loaded:false,que:[]},youtube:{active:false,array:[],api_loaded:false,que:[]},vimeo:{active:false,array:[],api_loaded:false,que:[]},webthumb:{active:false,array:[],api_loaded:false,que:[]},googlemaps:{active:false,map_active:false,places_active:false,array:[],api_loaded:false,que:[]},googledocs:{active:false,array:[],api_loaded:false,que:[]},googleplus:{active:false,array:[],api_loaded:false,que:[]},wikipedia:{active:false,array:[],api_loaded:false,que:[],tries:0},soundcloud:{active:false,array:[],api_loaded:false,que:[]}}).init();VMM.createElement=function(e,f,c,a,d){var b="";if(e!=null&&e!=""){b+="<"+e;if(c!=null&&c!=""){b+=" class='"+c+"'"}if(a!=null&&a!=""){b+=" "+a}if(d!=null&&d!=""){b+=" style='"+d+"'"}b+=">";if(f!=null&&f!=""){b+=f}b=b+"</"+e+">"}return b};VMM.createMediaElement=function(e,b,d){var c="";var a=false;c+="<div class='media'>";if(e!=null&&e!=""){valid=true;c+="<img src='"+e+"'>";if(d!=null&&d!=""){c+=VMM.createElement("div",d,"credit")}if(b!=null&&b!=""){c+=VMM.createElement("div",b,"caption")}}c+="</div>";return c};VMM.hideUrlBar=function(){var d=window,b=d.document;if(!location.hash||!d.addEventListener){window.scrollTo(0,1);var c=1,a=setInterval(function(){if(b.body){clearInterval(a);c="scrollTop" in b.body?b.body.scrollTop:1;d.scrollTo(0,c===1?0:1)}},15);d.addEventListener("load",function(){setTimeout(function(){d.scrollTo(0,c===1?0:1)},0)},false)}}}function trace(a){if(VMM.debug){if(window.console){console.log(a)}else{if(typeof(jsTrace)!="undefined"){jsTrace.send(a)}else{}}}}Array.prototype.remove=function(a,c){var b=this.slice((c||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,b)};Date.prototype.getWeek=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((((this-a)/86400000)+a.getDay()+1)/7)};Date.prototype.getDayOfYear=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((this-a)/86400000)};var is={Null:function(b){return b===null},Undefined:function(b){return b===undefined},nt:function(b){return(b===null||b===undefined)},Function:function(b){return(typeof(b)==="function")?b.constructor.toString().match(/Function/)!==null:false},String:function(b){return(typeof(b)==="string")?true:(typeof(b)==="object")?b.constructor.toString().match(/string/i)!==null:false},Array:function(b){return(typeof(b)==="object")?b.constructor.toString().match(/array/i)!==null||b.length!==undefined:false},Boolean:function(b){return(typeof(b)==="boolean")?true:(typeof(b)==="object")?b.constructor.toString().match(/boolean/i)!==null:false},Date:function(b){return(typeof(b)==="date")?true:(typeof(b)==="object")?b.constructor.toString().match(/date/i)!==null:false},HTML:function(b){return(typeof(b)==="object")?b.constructor.toString().match(/html/i)!==null:false},Number:function(b){return(typeof(b)==="number")?true:(typeof(b)==="object")?b.constructor.toString().match(/Number/)!==null:false},Object:function(b){return(typeof(b)==="object")?b.constructor.toString().match(/object/i)!==null:false},RegExp:function(b){return(typeof(b)==="function")?b.constructor.toString().match(/regexp/i)!==null:false}};var type={of:function(b){for(var c in is){if(is[c](b)){return c.toLowerCase()}}}};if(typeof VMM!="undefined"){VMM.smoothScrollTo=function(e,c,d){if(typeof(jQuery)!="undefined"){var b="easein",a=1000;if(c!=null){if(c<1){a=1}else{a=Math.round(c)}}if(d!=null&&d!=""){b=d}if(jQuery(window).scrollTop()!=VMM.Lib.offset(e).top){VMM.Lib.animate("html,body",a,b,{scrollTop:VMM.Lib.offset(e).top})}}};VMM.attachElement=function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).html(a)}};VMM.appendElement=function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).append(a)}};VMM.getHTML=function(b){var a;if(typeof(jQuery)!="undefined"){a=jQuery(b).html();return a}};VMM.getElement=function(b,c){var a;if(typeof(jQuery)!="undefined"){if(c){a=jQuery(b).parent().get(0)}else{a=jQuery(b).get(0)}return a}};VMM.bindEvent=function(d,h,g,f){var c;var b="click";var a={};if(g!=null&&g!=""){b=g}if(a!=null&&a!=""){a=f}if(typeof(jQuery)!="undefined"){jQuery(d).bind(b,a,h)}};VMM.unbindEvent=function(d,g,f){var c;var b="click";var a={};if(f!=null&&f!=""){b=f}if(typeof(jQuery)!="undefined"){jQuery(d).unbind(b,g)}};VMM.fireEvent=function(d,g,f){var c;var b="click";var a=[];if(g!=null&&g!=""){b=g}if(f!=null&&f!=""){a=f}if(typeof(jQuery)!="undefined"){jQuery(d).trigger(b,a)}};VMM.getJSON=function(d,b,a){if(typeof(jQuery)!="undefined"){jQuery.ajaxSetup({timeout:3000});if(VMM.Browser.browser=="Explorer"&&parseInt(VMM.Browser.version,10)>=7&&window.XDomainRequest){trace("IE JSON");var c=d;if(c.match("^http://")){return jQuery.getJSON(c,b,a)}else{if(c.match("^https://")){c=c.replace("https://","http://");return jQuery.getJSON(c,b,a)}else{return jQuery.getJSON(d,b,a)}}}else{return jQuery.getJSON(d,b,a)}}};VMM.parseJSON=function(a){if(typeof(jQuery)!="undefined"){return jQuery.parseJSON(a)}};VMM.appendAndGetElement=function(f,k,g,h){var j,d="<div>",a="",b="",c="";if(k!=null&&k!=""){d=k}if(g!=null&&g!=""){a=g}if(h!=null&&h!=""){b=h}if(typeof(jQuery)!="undefined"){j=jQuery(k);j.addClass(a);j.html(b);jQuery(f).append(j)}return j};VMM.Lib={init:function(){return this},hide:function(b,a){if(a!=null&&a!=""){if(typeof(jQuery)!="undefined"){jQuery(b).hide(a)}}else{if(typeof(jQuery)!="undefined"){jQuery(b).hide()}}},remove:function(a){if(typeof(jQuery)!="undefined"){jQuery(a).remove()}},detach:function(a){if(typeof(jQuery)!="undefined"){jQuery(a).detach()}},append:function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).append(b)}},prepend:function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).prepend(b)}},show:function(b,a){if(a!=null&&a!=""){if(typeof(jQuery)!="undefined"){jQuery(b).show(a)}}else{if(typeof(jQuery)!="undefined"){jQuery(b).show()}}},load:function(c,b,d){var a={elem:c};if(a!=null&&a!=""){a=d}if(typeof(jQuery)!="undefined"){jQuery(c).load(a,b)}},addClass:function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).addClass(a)}},removeClass:function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).removeClass(a)}},attr:function(b,a,c){if(c!=null&&c!=""){if(typeof(jQuery)!="undefined"){jQuery(b).attr(a,c)}}else{if(typeof(jQuery)!="undefined"){return jQuery(b).attr(a)}}},prop:function(b,a,c){if(typeof jQuery=="undefined"||!/[1-9]\.[3-9].[1-9]/.test(jQuery.fn.jquery)){VMM.Lib.attribute(b,a,c)}else{jQuery(b).prop(a,c)}},attribute:function(b,a,c){if(c!=null&&c!=""){if(typeof(jQuery)!="undefined"){jQuery(b).attr(a,c)}}else{if(typeof(jQuery)!="undefined"){return jQuery(b).attr(a)}}},visible:function(a,b){if(b!=null){if(typeof(jQuery)!="undefined"){if(b){jQuery(a).show(0)}else{jQuery(a).hide(0)}}}else{if(typeof(jQuery)!="undefined"){if(jQuery(a).is(":visible")){return true}else{return false}}}},css:function(a,b,c){if(c!=null&&c!=""){if(typeof(jQuery)!="undefined"){jQuery(a).css(b,c)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).css(b)}}},cssmultiple:function(a,b){if(typeof(jQuery)!="undefined"){return jQuery(a).css(b)}},offset:function(a){var b;if(typeof(jQuery)!="undefined"){b=jQuery(a).offset()}return b},position:function(a){var b;if(typeof(jQuery)!="undefined"){b=jQuery(a).position()}return b},width:function(a,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).width(b)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).width()}}},height:function(a,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).height(b)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).height()}}},toggleClass:function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).toggleClass(a)}},each:function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).each(b)}},html:function(b,c){var a;if(typeof(jQuery)!="undefined"){a=jQuery(b).html();return a}if(c!=null&&c!=""){if(typeof(jQuery)!="undefined"){jQuery(b).html(c)}}else{var a;if(typeof(jQuery)!="undefined"){a=jQuery(b).html();return a}}},find:function(a,b){if(typeof(jQuery)!="undefined"){return jQuery(a).find(b)}},stop:function(a){if(typeof(jQuery)!="undefined"){jQuery(a).stop()}},delay_animate:function(e,h,f,g,c,d){if(VMM.Browser.device=="mobile"||VMM.Browser.device=="tablet"){var b=Math.round((f/1500)*10)/10,a=b+"s";VMM.Lib.css(h,"-webkit-transition","all "+a+" ease");VMM.Lib.css(h,"-moz-transition","all "+a+" ease");VMM.Lib.css(h,"-o-transition","all "+a+" ease");VMM.Lib.css(h,"-ms-transition","all "+a+" ease");VMM.Lib.css(h,"transition","all "+a+" ease");VMM.Lib.cssmultiple(h,_att)}else{if(typeof(jQuery)!="undefined"){jQuery(h).delay(e).animate(c,{duration:f,easing:g})}}},animate:function(l,j,k,g,m,h){var d="easein",e=false,c=1000,b={};if(j!=null){if(j<1){c=1}else{c=Math.round(j)}}if(k!=null&&k!=""){d=k}if(m!=null&&m!=""){e=m}if(g!=null){b=g}else{b={opacity:0}}if(VMM.Browser.device=="mobile"||VMM.Browser.device=="tablet"){var f=Math.round((c/1500)*10)/10,a=f+"s";d=" cubic-bezier(0.33, 0.66, 0.66, 1)";for(x in b){if(Object.prototype.hasOwnProperty.call(b,x)){trace(x+" to "+b[x]);VMM.Lib.css(l,"-webkit-transition",x+" "+a+d);VMM.Lib.css(l,"-moz-transition",x+" "+a+d);VMM.Lib.css(l,"-o-transition",x+" "+a+d);VMM.Lib.css(l,"-ms-transition",x+" "+a+d);VMM.Lib.css(l,"transition",x+" "+a+d)}}VMM.Lib.cssmultiple(l,b)}else{if(typeof(jQuery)!="undefined"){if(h!=null&&h!=""){jQuery(l).animate(b,{queue:e,duration:c,easing:d,complete:h})}else{jQuery(l).animate(b,{queue:e,duration:c,easing:d})}}}}}}if(typeof(jQuery)!="undefined"){(function(a){if(window.XDomainRequest){a.ajaxTransport(function(b){if(b.crossDomain&&b.async){if(b.timeout){b.xdrTimeout=b.timeout;delete b.timeout}var c;return{send:function(d,f){function e(j,k,h,g){c.onload=c.onerror=c.ontimeout=a.noop;c=undefined;f(j,k,h,g)}c=new XDomainRequest();c.open(b.type,b.url);c.onload=function(){e(200,"OK",{text:c.responseText},"Content-Type: "+c.contentType)};c.onerror=function(){e(404,"Not Found")};if(b.xdrTimeout){c.ontimeout=function(){e(0,"timeout")};c.timeout=b.xdrTimeout}c.send((b.hasContent&&b.data)||null)},abort:function(){if(c){c.onerror=a.noop();c.abort()}}}}})}})(jQuery);jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(h,g,a,e,f){return jQuery.easing[jQuery.easing.def](h,g,a,e,f)},easeInExpo:function(h,g,a,e,f){return(g==0)?a:e*Math.pow(2,10*(g/f-1))+a},easeOutExpo:function(h,g,a,e,f){return(g==f)?a+e:e*(-Math.pow(2,-10*g/f)+1)+a},easeInOutExpo:function(h,g,a,e,f){if(g==0){return a}if(g==f){return a+e}if((g/=f/2)<1){return e/2*Math.pow(2,10*(g-1))+a}return e/2*(-Math.pow(2,-10*--g)+2)+a},easeInQuad:function(h,g,a,e,f){return e*(g/=f)*g+a},easeOutQuad:function(h,g,a,e,f){return -e*(g/=f)*(g-2)+a},easeInOutQuad:function(h,g,a,e,f){if((g/=f/2)<1){return e/2*g*g+a}return -e/2*((--g)*(g-2)-1)+a}})}if(typeof VMM!="undefined"&&typeof VMM.Browser=="undefined"){VMM.Browser={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";this.device=this.searchDevice(navigator.userAgent);this.orientation=this.searchOrientation(window.orientation)},searchOrientation:function(b){var a="";if(b==0||b==180){a="portrait"}else{if(b==90||b==-90){a="landscape"}else{a="normal"}}return a},searchDevice:function(a){var b="";if(a.match(/Android/i)||a.match(/iPhone|iPod/i)){b="mobile"}else{if(a.match(/iPad/i)){b="tablet"}else{if(a.match(/BlackBerry/i)||a.match(/IEMobile/i)){b="other mobile"}else{b="desktop"}}}return b},searchString:function(a){for(var d=0;d<a.length;d++){var c=a[d].string,b=a[d].prop;this.versionSearchString=a[d].versionSearch||a[d].identity;if(c){if(c.indexOf(a[d].subString)!=-1){return a[d].identity}}else{if(b){return a[d].identity}}}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1){return}return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};VMM.Browser.init()}if(typeof VMM!="undefined"&&typeof VMM.FileExtention=="undefined"){VMM.FileExtention={googleDocType:function(e){var b=e.replace(/\s\s*$/,""),a="",f=["DOC","DOCX","XLS","XLSX","PPT","PPTX","PDF","PAGES","AI","PSD","TIFF","DXF","SVG","EPS","PS","TTF","XPS","ZIP","RAR"],c=false;a=b.substr(b.length-5,5);for(var d=0;d<f.length;d++){if(a.toLowerCase().match(f[d].toString().toLowerCase())||b.match("docs.google.com")){c=true}}return c}}}if(typeof VMM!="undefined"&&typeof VMM.Date=="undefined"){VMM.Date=({init:function(){return this},dateformats:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time_no_seconds_short:"h:MM TT",time_no_seconds_small_date:"h:MM TT'<br/><small>'mmmm d',' yyyy'</small>'",full_long:"mmm d',' yyyy 'at' hh:MM TT",full_long_small_date:"hh:MM TT'<br/><small>mmm d',' yyyy'</small>'"},month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr:["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_abbr:["Sun.","Mon.","Tues.","Wed.","Thurs.","Fri.","Sat."],hour:[1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12],hour_suffix:["am"],bc_format:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time_no_seconds_short:"h:MM TT",time_no_seconds_small_date:"dddd', 'h:MM TT'<br/><small>'mmmm d',' yyyy'</small>'",full_long:"dddd',' mmm d',' yyyy 'at' hh:MM TT",full_long_small_date:"hh:MM TT'<br/><small>'dddd',' mmm d',' yyyy'</small>'"},setLanguage:function(a){trace("SET DATE LANGUAGE");VMM.Date.dateformats=a.dateformats;VMM.Date.month=a.date.month;VMM.Date.month_abbr=a.date.month_abbr;VMM.Date.day=a.date.day;VMM.Date.day_abbr=a.date.day_abbr;dateFormat.i18n.dayNames=a.date.day_abbr.concat(a.date.day);dateFormat.i18n.monthNames=a.date.month_abbr.concat(a.date.month)},parse:function(a,h){var b,c,j,k,g={year:false,month:false,day:false,hour:false,minute:false,second:false,millisecond:false};if(type.of(a)=="date"){b=a}else{b=new Date(0,0,1,0,0,0,0);if(a.match(/,/gi)){c=a.split(",");for(var e=0;e<c.length;e++){c[e]=parseInt(c[e],10)}if(c[0]){b.setFullYear(c[0]);g.year=true}if(c[1]){b.setMonth(c[1]-1);g.month=true}if(c[2]){b.setDate(c[2]);g.day=true}if(c[3]){b.setHours(c[3]);g.hour=true}if(c[4]){b.setMinutes(c[4]);g.minute=true}if(c[5]){b.setSeconds(c[5]);g.second=true}if(c[6]){b.setMilliseconds(c[6]);g.millisecond=true}}else{if(a.match("/")){if(a.match(" ")){k=a.split(" ");if(a.match(":")){j=k[1].split(":");if(j[0]>=0){b.setHours(j[0]);g.hour=true}if(j[1]>=0){b.setMinutes(j[1]);g.minute=true}if(j[2]>=0){b.setSeconds(j[2]);g.second=true}if(j[3]>=0){b.setMilliseconds(j[3]);g.millisecond=true}}c=k[0].split("/")}else{c=a.split("/")}if(c[2]){b.setFullYear(c[2]);g.year=true}if(c[0]>=0){b.setMonth(c[0]-1);g.month=true}if(c[1]>=0){if(c[1].length>2){b.setFullYear(c[1]);g.year=true}else{b.setDate(c[1]);g.day=true}}}else{if(a.match("now")){var f=new Date();b.setFullYear(f.getFullYear());g.year=true;b.setMonth(f.getMonth());g.month=true;b.setDate(f.getDate());g.day=true;if(a.match("hours")){b.setHours(f.getHours());g.hour=true}if(a.match("minutes")){b.setHours(f.getHours());b.setMinutes(f.getMinutes());g.hour=true;g.minute=true}if(a.match("seconds")){b.setHours(f.getHours());b.setMinutes(f.getMinutes());b.setSeconds(f.getSeconds());g.hour=true;g.minute=true;g.second=true}if(a.match("milliseconds")){b.setHours(f.getHours());b.setMinutes(f.getMinutes());b.setSeconds(f.getSeconds());b.setMilliseconds(f.getMilliseconds());g.hour=true;g.minute=true;g.second=true;g.millisecond=true}}else{if(a.length<=5){g.year=true;b.setFullYear(parseInt(a,10));b.setMonth(0);b.setDate(1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0)}else{if(a.match("T")){if(navigator.userAgent.match(/MSIE\s(?!9.0)/)){k=a.split("T");if(a.match(":")){j=k[1].split(":");if(j[0]>=1){b.setHours(j[0]);g.hour=true}if(j[1]>=1){b.setMinutes(j[1]);g.minute=true}if(j[2]>=1){b.setSeconds(j[2]);g.second=true}if(j[3]>=1){b.setMilliseconds(j[3]);g.millisecond=true}}c=k[0].split("-");if(c[0]){b.setFullYear(c[0]);g.year=true}if(c[1]>=0){b.setMonth(c[1]-1);g.month=true}if(c[2]>=0){b.setDate(c[2]);g.day=true}}else{b=new Date(Date.parse(a))}}else{g.year=true;g.month=true;g.day=true;g.hour=true;g.minute=true;g.second=true;g.millisecond=true;b=new Date(parseInt(a.slice(0,4),10),parseInt(a.slice(4,6),10)-1,parseInt(a.slice(6,8),10),parseInt(a.slice(8,10),10),parseInt(a.slice(10,12),10))}}}}}}if(h!=null&&h!=""){return{date:b,precision:g}}else{return b}},prettyDate:function(h,n,r,k){var a,b,l,c,o=false,f,e,g;if(k!=null&&k!=""&&typeof k!="undefined"){o=true;trace("D2 "+k)}if(type.of(h)=="date"){if(type.of(r)=="object"){if(r.millisecond||r.second||r.minute){if(n){l=VMM.Date.dateformats.time_no_seconds_short}else{l=VMM.Date.dateformats.time_no_seconds_small_date}}else{if(r.hour){if(n){l=VMM.Date.dateformats.time_no_seconds_short}else{l=VMM.Date.dateformats.time_no_seconds_small_date}}else{if(r.day){if(n){l=VMM.Date.dateformats.full_short}else{l=VMM.Date.dateformats.full}}else{if(r.month){if(n){l=VMM.Date.dateformats.month_short}else{l=VMM.Date.dateformats.month}}else{if(r.year){l=VMM.Date.dateformats.year}else{l=VMM.Date.dateformats.year}}}}}}else{if(h.getMonth()===0&&h.getDate()==1&&h.getHours()===0&&h.getMinutes()===0){l=VMM.Date.dateformats.year}else{if(h.getDate()<=1&&h.getHours()===0&&h.getMinutes()===0){if(n){l=VMM.Date.dateformats.month_short}else{l=VMM.Date.dateformats.month}}else{if(h.getHours()===0&&h.getMinutes()===0){if(n){l=VMM.Date.dateformats.full_short}else{l=VMM.Date.dateformats.full}}else{if(h.getMinutes()===0){if(n){l=VMM.Date.dateformats.time_no_seconds_short}else{l=VMM.Date.dateformats.time_no_seconds_small_date}}else{if(n){l=VMM.Date.dateformats.time_no_seconds_short}else{l=VMM.Date.dateformats.full_long}}}}}}a=dateFormat(h,l,false);c=a.split(" ");for(var m=0;m<c.length;m++){if(parseInt(c[m],10)<0){trace("YEAR IS BC");f=c[m];e=Math.abs(parseInt(c[m],10));g=e.toString()+" B.C.";a=a.replace(f,g)}}if(o){b=dateFormat(k,l,false);c=b.split(" ");for(var q=0;q<c.length;q++){if(parseInt(c[q],10)<0){trace("YEAR IS BC");f=c[q];e=Math.abs(parseInt(c[q],10));g=e.toString()+" B.C.";b=b.replace(f,g)}}}}else{trace("NOT A VALID DATE?");trace(h)}if(o){return a+" &mdash; "+b}else{return a}}}).init();var dateFormat=function(){var d=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,a=function(f,e){f=String(f);e=e||2;while(f.length<e){f="0"+f}return f};return function(h,r,v){var j=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(h)=="[object String]"&&!/\d/.test(h)){r=h;h=undefined}if(isNaN(h)){trace("invalid date "+h)}r=String(j.masks[r]||r||j.masks["default"]);if(r.slice(0,4)=="UTC:"){r=r.slice(4);v=true}var e=v?"getUTC":"get",f=h[e+"Date"](),g=h[e+"Day"](),p=h[e+"Month"](),w=h[e+"FullYear"](),l=h[e+"Hours"](),q=h[e+"Minutes"](),u=h[e+"Seconds"](),n=h[e+"Milliseconds"](),t=v?0:h.getTimezoneOffset(),k={d:f,dd:a(f),ddd:j.i18n.dayNames[g],dddd:j.i18n.dayNames[g+7],m:p+1,mm:a(p+1),mmm:j.i18n.monthNames[p],mmmm:j.i18n.monthNames[p+12],yy:String(w).slice(2),yyyy:w,h:l%12||12,hh:a(l%12||12),H:l,HH:a(l),M:q,MM:a(q),s:u,ss:a(u),l:a(n,3),L:a(n>99?Math.round(n/10):n),t:l<12?"a":"p",tt:l<12?"am":"pm",T:l<12?"A":"P",TT:l<12?"AM":"PM",Z:v?"UTC":(String(h).match(b)||[""]).pop().replace(c,""),o:(t>0?"-":"+")+a(Math.floor(Math.abs(t)/60)*100+Math.abs(t)%60,4),S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10]};return r.replace(d,function(m){return m in k?k[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){return dateFormat(this,a,b)}}if(typeof VMM!="undefined"&&typeof VMM.Util=="undefined"){VMM.Util=({init:function(){return this},correctProtocol:function(d){var a=(window.parent.location.protocol).toString(),b="",c=d.split("://",2);if(a.match("http")){b=a}else{b="https"}return b+"://"+c[1]},mergeConfig:function(a,b){var c;for(c in b){if(Object.prototype.hasOwnProperty.call(b,c)){a[c]=b[c]}}return a},getObjectAttributeByIndex:function(d,c){if(typeof d!="undefined"){var b=0;for(var a in d){if(c===b){return d[a]}b++}return""}else{return""}},ordinal:function(a){return["th","st","nd","rd"][(!(((a%10)>3)||(Math.floor(a%100/10)==1)))*(a%10)]},randomBetween:function(b,a){return Math.floor(Math.random()*(a-b+1)+b)},average:function(b){var e={mean:0,variance:0,deviation:0},g=b.length;for(var d,f=0,c=g;c--;f+=b[c]){}for(d=e.mean=f/g,c=g,f=0;c--;f+=Math.pow(b[c]-d,2)){}return e.deviation=Math.sqrt(e.variance=f/g),e},customSort:function(c,e){var d=c,f=e;if(d==f){return 0}return d>f?1:-1},deDupeArray:function(a){var b,c=a.length,e=[],d={};for(b=0;b<c;b++){d[a[b]]=0}for(b in d){e.push(b)}return e},number2money:function(b,e,d){var e=(e!==null)?e:true;var d=(d!==null)?d:false;var c=VMM.Math2.floatPrecision(b,2);var a=this.niceNumber(c);if(!a.split(/\./g)[1]&&d){a=a+".00"}if(e){a="$"+a}return a},wordCount:function(f){var b=f+" ";var c=/^[^A-Za-z0-9\'\-]+/gi;var d=b.replace(c,"");var e=/[^A-Za-z0-9\'\-]+/gi;var a=d.replace(e," ");var g=a.split(" ");var h=g.length-1;if(b.length<2){h=0}return h},ratio:{fit:function(e,b,d,c){var a={width:0,height:0};a.width=e;a.height=Math.round((e/d)*c);if(a.height>b){a.height=b;a.width=Math.round((b/c)*d);if(a.width>e){trace("FIT: DIDN'T FIT!!! ")}}return a},r16_9:function(b,a){if(b!==null&&b!==""){return Math.round((a/16)*9)}else{if(a!==null&&a!==""){return Math.round((b/9)*16)}}},r4_3:function(b,a){if(b!==null&&b!==""){return Math.round((a/4)*3)}else{if(a!==null&&a!==""){return Math.round((b/3)*4)}}}},doubledigit:function(a){return(a<10?"0":"")+a},truncateWords:function(h,f,e){if(!f){f=30}if(!e){e=f}var b=/^[^A-Za-z0-9\'\-]+/gi;var d=h.replace(b,"");var l=d.split(" ");var g=[];f=Math.min(l.length,f);e=Math.min(l.length,e);for(var a=0;a<f;a++){g.push(l[a])}for(var c=f;a<e;a++){var k=l[a];g.push(k);if(k.charAt(k.length-1)=="."){break}}return(g.join(" "))},linkify:function(e,d,b){var f=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim;var c=/(^|[^\/])(www\.[\S]+(\b|$))/gim;var a=/(([a-zA-Z0-9_\-\.]+)@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6}))+/gim;return e.replace(f,"<a target='_blank' href='$&' onclick='void(0)'>$&</a>").replace(c,"$1<a target='_blank' onclick='void(0)' href='http://$2'>$2</a>").replace(a,"<a target='_blank' onclick='void(0)' href='mailto:$1'>$1</a>")},linkify_with_twitter:function(f,e,b){var l=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim;var j=/(\()((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\))|(\[)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\])|(\{)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\})|(<|&(?:lt|#60|#x3c);)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(>|&(?:gt|#62|#x3e);)|((?:^|[^=\s'"\]])\s*['"]?|[^=\s]\s+)(\b(?:ht|f)tps?:\/\/[a-z0-9\-._~!$'()*+,;=:\/?#[\]@%]+(?:(?!&(?:gt|#0*62|#x0*3e);|&(?:amp|apos|quot|#0*3[49]|#x0*2[27]);[.!&',:?;]?(?:[^a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]|$))&[a-z0-9\-._~!$'()*+,;=:\/?#[\]@%]*)*[a-z0-9\-_~$()*+=\/#[\]@%])/img;var k='$1$4$7$10$13<a href="$2$5$8$11$14" class="hyphenate">$2$5$8$11$14</a>$3$6$9$12';var c=/(^|[^\/])(www\.[\S]+(\b|$))/gim;function d(n){var m=/(\b(https?|ftp|file):\/\/([-A-Z0-9+&@#%?=~_|!:,.;]*)([-A-Z0-9+&@#%?\/=~_|!:,.;]*)[-A-Z0-9+&@#\/%=~_|])/ig;return n.replace(m,"<a href='$1' target='_blank'>$3</a>")}var a=/(([a-zA-Z0-9_\-\.]+)@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6}))+/gim;var g=/\B@([\w-]+)/gm;var h=/(#([\w]+))/g;return f.replace(j,k).replace(c,"$1<a target='_blank' class='hyphenate' onclick='void(0)' href='http://$2'>$2</a>").replace(a,"<a target='_blank' onclick='void(0)' href='mailto:$1'>$1</a>").replace(g,"<a href='http://twitter.com/$1' target='_blank' onclick='void(0)'>@$1</a>").replace(h,"<a href='http://twitter.com/#search?q=%23$2' target='_blank' 'void(0)'>$1</a>")},linkify_wikipedia:function(a){var b=/<i[^>]*>(.*?)<\/i>/gim;return a.replace(b,"<a target='_blank' href='http://en.wikipedia.org/wiki/$&' onclick='void(0)'>$&</a>").replace(/<i\b[^>]*>/gim,"").replace(/<\/i>/gim,"").replace(/<b\b[^>]*>/gim,"").replace(/<\/b>/gim,"")},unlinkify:function(a){if(!a){return a}a=a.replace(/<a\b[^>]*>/i,"");a=a.replace(/<\/a>/i,"");return a},untagify:function(a){if(!a){return a}a=a.replace(/<\s*\w.*?>/g,"");return a},nl2br:function(a){return a.replace(/(\r\n|[\r\n]|\\n|\\r)/g,"<br/>")},unique_ID:function(d){var b=function(e){return Math.floor(Math.random()*e)};var a=function(){var e="abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";return e.substr(b(62),1)};var c=function(f){var g="";for(var e=0;e<f;e++){g+=a()}return g};return c(d)},isEven:function(a){return(a%2===0)?true:false},getUrlVars:function(e){var d=e.toString();if(d.match("&#038;")){d=d.replace("&#038;","&")}else{if(d.match("&#38;")){d=d.replace("&#38;","&")}else{if(d.match("&amp;")){d=d.replace("&amp;","&")}}}var f=[],a;var b=d.slice(d.indexOf("?")+1).split("&");for(var c=0;c<b.length;c++){a=b[c].split("=");f.push(a[0]);f[a[0]]=a[1]}return f},toHTML:function(a){a=this.nl2br(a);a=this.linkify(a);return a.replace(/\s\s/g,"&nbsp;&nbsp;")},toCamelCase:function(c,a){if(a!==false){a=true}var d=((a)?c.toLowerCase():c).split(" ");for(var b=0;b<d.length;b++){d[b]=d[b].substr(0,1).toUpperCase()+d[b].substr(1)}return d.join(" ")},properQuotes:function(a){return a.replace(/\"([^\"]*)\"/gi,"&#8220;$1&#8221;")},niceNumber:function(a){a+="";x=a.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var b=/(\d+)(\d{3})/;while(b.test(x1)){x1=x1.replace(b,"$1,$2")}return x1+x2},toTitleCase:function(b){if(VMM.Browser.browser=="Explorer"&&parseInt(VMM.Browser.version,10)>=7){return b.replace("_","%20")}else{var a={__smallWords:["a","an","and","as","at","but","by","en","for","if","in","of","on","or","the","to","v[.]?","via","vs[.]?"],init:function(){this.__smallRE=this.__smallWords.join("|");this.__lowerCaseWordsRE=new RegExp("\\b("+this.__smallRE+")\\b","gi");this.__firstWordRE=new RegExp("^([^a-zA-Z0-9 \\r\\n\\t]*)("+this.__smallRE+")\\b","gi");this.__lastWordRE=new RegExp("\\b("+this.__smallRE+")([^a-zA-Z0-9 \\r\\n\\t]*)$","gi")},toTitleCase:function(g){var d="";var f=g.split(/([:.;?!][ ]|(?:[ ]|^)["“])/);for(var c=0;c<f.length;++c){var e=f[c];e=e.replace(/\b([a-zA-Z][a-z.'’]*)\b/g,this.__titleCaseDottedWordReplacer);e=e.replace(this.__lowerCaseWordsRE,this.__lowerReplacer);e=e.replace(this.__firstWordRE,this.__firstToUpperCase);e=e.replace(this.__lastWordRE,this.__firstToUpperCase);d+=e}d=d.replace(/ V(s?)\. /g," v$1. ");d=d.replace(/(['’])S\b/g,"$1s");d=d.replace(/\b(AT&T|Q&A)\b/ig,this.__upperReplacer);return d},__titleCaseDottedWordReplacer:function(c){return(c.match(/[a-zA-Z][.][a-zA-Z]/))?c:a.__firstToUpperCase(c)},__lowerReplacer:function(c){return c.toLowerCase()},__upperReplacer:function(c){return c.toUpperCase()},__firstToUpperCase:function(d){var c=d.split(/(^[^a-zA-Z0-9]*[a-zA-Z0-9])(.*)$/);if(c[1]){c[1]=c[1].toUpperCase()}return c.join("")}};a.init();b=b.replace(/_/g," ");b=a.toTitleCase(b);return b}}}).init()}LazyLoad=(function(b){var c,f,h={},j=0,m={css:[],js:[]},n=b.styleSheets;function a(q,p){var r=b.createElement(q),o;for(o in p){if(p.hasOwnProperty(o)){r.setAttribute(o,p[o])}}return r}function d(r){var q=h[r],o,s;if(q){o=q.callback;s=q.urls;s.shift();j=0;if(!s.length){o&&o.call(q.context,q.obj);h[r]=null;m[r].length&&g(r)}}}function e(){var o=navigator.userAgent;c={async:b.createElement("script").async===true};(c.webkit=/AppleWebKit\//.test(o))||(c.ie=/MSIE/.test(o))||(c.opera=/Opera/.test(o))||(c.gecko=/Gecko\//.test(o))||(c.unknown=true)}function g(B,D,q,y,r){var o=function(){d(B)},t=B==="css",w=[],s,u,v,z,A,C;c||e();if(D){D=typeof D==="string"?[D]:D.concat();if(t||c.async||c.gecko||c.opera){m[B].push({urls:D,callback:q,obj:y,context:r})}else{for(s=0,u=D.length;s<u;++s){m[B].push({urls:[D[s]],callback:s===u-1?q:null,obj:y,context:r})}}}if(h[B]||!(z=h[B]=m[B].shift())){return}f||(f=b.head||b.getElementsByTagName("head")[0]);A=z.urls;for(s=0,u=A.length;s<u;++s){C=A[s];if(t){v=c.gecko?a("style"):a("link",{href:C,rel:"stylesheet"})}else{v=a("script",{src:C});v.async=false}v.className="lazyload";v.setAttribute("charset","utf-8");if(c.ie&&!t){v.onreadystatechange=function(){if(/loaded|complete/.test(v.readyState)){v.onreadystatechange=null;o()}}}else{if(t&&(c.gecko||c.webkit)){if(c.webkit){z.urls[s]=v.href;l()}else{v.innerHTML='@import "'+C+'";';k(v)}}else{v.onload=v.onerror=o}}w.push(v)}for(s=0,u=w.length;s<u;++s){f.appendChild(w[s])}}function k(q){var p;try{p=!!q.sheet.cssRules}catch(o){j+=1;if(j<200){setTimeout(function(){k(q)},50)}else{p&&d("css")}return}d("css")}function l(){var o=h.css,p;if(o){p=n.length;while(--p>=0){if(n[p].href===o.urls[0]){d("css");break}}j+=1;if(o){if(j<200){setTimeout(l,50)}else{d("css")}}}}return{css:function(r,o,q,p){g("css",r,o,q,p)},js:function(r,o,q,p){g("js",r,o,q,p)}}})(this.document);LoadLib=(function(a){var c=[];function b(f){var e=0,d=false;for(e=0;e<c.length;e++){if(c[e]==f){d=true}}if(d){return true}else{c.push(f);return false}}return{css:function(g,d,f,e){if(!b(g)){LazyLoad.css(g,d,f,e)}},js:function(g,d,f,e){if(!b(g)){LazyLoad.js(g,d,f,e)}}}})(this.document);if(typeof VMM!="undefined"&&typeof VMM.Language=="undefined"){VMM.Language={lang:"en",api:{wikipedia:"en"},date:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr:["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_abbr:["Sun.","Mon.","Tues.","Wed.","Thurs.","Fri.","Sat."]},dateformats:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time_no_seconds_short:"h:MM TT",time_no_seconds_small_date:"h:MM TT'<br/><small>'mmmm d',' yyyy'</small>'",full_long:"mmm d',' yyyy 'at' h:MM TT",full_long_small_date:"h:MM TT'<br/><small>mmm d',' yyyy'</small>'"},messages:{loading_timeline:"Loading Timeline... ",return_to_title:"Return to Title",expand_timeline:"Expand Timeline",contract_timeline:"Contract Timeline",wikipedia:"From Wikipedia, the free encyclopedia",loading_content:"Loading Content",loading:"Loading"}}}if(typeof VMM!="undefined"&&typeof VMM.ExternalAPI=="undefined"){VMM.ExternalAPI=({keys:{google:"",flickr:"",twitter:""},keys_master:{vp:"Pellentesque nibh felis, eleifend id, commodo in, interdum vitae, leo",flickr:"RAIvxHY4hE/Elm5cieh4X5ptMyDpj7MYIxziGxi0WGCcy1s+yr7rKQ==",google:"jwNGnYw4hE9lmAez4ll0QD+jo6SKBJFknkopLS4FrSAuGfIwyj57AusuR0s8dAo=",twitter:""},init:function(){return this},setKeys:function(a){VMM.ExternalAPI.keys=a},pushQues:function(){if(VMM.master_config.googlemaps.active){VMM.ExternalAPI.googlemaps.pushQue()}if(VMM.master_config.youtube.active){VMM.ExternalAPI.youtube.pushQue()}if(VMM.master_config.soundcloud.active){VMM.ExternalAPI.soundcloud.pushQue()}if(VMM.master_config.googledocs.active){VMM.ExternalAPI.googledocs.pushQue()}if(VMM.master_config.googleplus.active){VMM.ExternalAPI.googleplus.pushQue()}if(VMM.master_config.wikipedia.active){VMM.ExternalAPI.wikipedia.pushQue()}if(VMM.master_config.vimeo.active){VMM.ExternalAPI.vimeo.pushQue()}if(VMM.master_config.twitter.active){VMM.ExternalAPI.twitter.pushQue()}if(VMM.master_config.flickr.active){VMM.ExternalAPI.flickr.pushQue()}if(VMM.master_config.webthumb.active){VMM.ExternalAPI.webthumb.pushQue()}},twitter:{tweetArray:[],get:function(a){var b={mid:a.id,id:a.uid};VMM.master_config.twitter.que.push(b);VMM.master_config.twitter.active=true},create:function(f,a){var d=f.mid.toString(),c={twitterid:f.mid},e="http://api.twitter.com/1/statuses/show.json?id="+f.mid+"&include_entities=true&callback=?",g=setTimeout(VMM.ExternalAPI.twitter.errorTimeOut,VMM.master_config.timers.api,f),b=setTimeout(a,VMM.master_config.timers.api,f);VMM.getJSON(e,function(h){var j=h.id_str,l="<blockquote><p>",k=VMM.Util.linkify_with_twitter(h.text,"_blank");l+=k;l+="</p></blockquote>";if(typeof h.entities.media!="undefined"){if(h.entities.media[0].type=="photo"){}}l+="<div class='vcard author'>";l+="<a class='screen-name url' href='https://twitter.com/"+h.user.screen_name+"' data-screen-name='"+h.user.screen_name+"' target='_blank'>";l+="<span class='avatar'><img src=' "+h.user.profile_image_url+"'  alt=''></span>";l+="<span class='fn'>"+h.user.name+"</span>";l+="<span class='nickname'>@"+h.user.screen_name+"<span class='thumbnail-inline'></span></span>";l+="</a>";l+="</div>";VMM.attachElement("#"+f.id.toString(),l);VMM.attachElement("#text_thumb_"+f.id.toString(),h.text);VMM.attachElement("#marker_content_"+f.id.toString(),h.text)}).error(function(j,k,h){trace("TWITTER error");trace("TWITTER ERROR: "+k+" "+j.responseText);VMM.attachElement("#"+f.id,VMM.MediaElement.loadingmessage("ERROR LOADING TWEET "+f.mid))}).success(function(h){clearTimeout(g);clearTimeout(b);a()})},errorTimeOut:function(a){trace("TWITTER JSON ERROR TIMEOUT "+a.mid);VMM.attachElement("#"+a.id.toString(),VMM.MediaElement.loadingmessage("Still waiting on Twitter: "+a.mid));VMM.getJSON("http://api.twitter.com/1/account/rate_limit_status.json",function(b){trace("REMAINING TWITTER API CALLS "+b.remaining_hits);trace("TWITTER RATE LIMIT WILL RESET AT "+b.reset_time);var c="";if(b.remaining_hits==0){c="<p>You've reached the maximum number of tweets you can load in an hour.</p>";c+="<p>You can view tweets again starting at: <br/>"+b.reset_time+"</p>"}else{c="<p>Still waiting on Twitter. "+a.mid+"</p>"}VMM.attachElement("#"+a.id.toString(),VMM.MediaElement.loadingmessage(c))})},pushQue:function(){if(VMM.master_config.twitter.que.length>0){VMM.ExternalAPI.twitter.create(VMM.master_config.twitter.que[0],VMM.ExternalAPI.twitter.pushQue);VMM.master_config.twitter.que.remove(0)}},getHTML:function(a){var b="http://api.twitter.com/1/statuses/oembed.json?id="+a+"&callback=?";VMM.getJSON(b,VMM.ExternalAPI.twitter.onJSONLoaded)},onJSONLoaded:function(a){trace("TWITTER JSON LOADED");var b=a.id;VMM.attachElement("#"+b,VMM.Util.linkify_with_twitter(a.html))},parseTwitterDate:function(a){var b=new Date(Date.parse(a));return b},prettyParseTwitterDate:function(a){var b=new Date(Date.parse(a));return VMM.Date.prettyDate(b,true)},getTweets:function(e){var d=[];var b=e.length;for(var a=0;a<e.length;a++){var f="";if(e[a].tweet.match("status/")){f=e[a].tweet.split("status/")[1]}else{if(e[a].tweet.match("statuses/")){f=e[a].tweet.split("statuses/")[1]}else{f=""}}var c="http://api.twitter.com/1/statuses/show.json?id="+f+"&include_entities=true&callback=?";VMM.getJSON(c,function(g){var k={};var l="<div class='twitter'><blockquote><p>";var h=VMM.Util.linkify_with_twitter(g.text,"_blank");l+=h;l+="</p>";l+="— "+g.user.name+" (<a href='https://twitter.com/"+g.user.screen_name+"'>@"+g.user.screen_name+"</a>) <a href='https://twitter.com/"+g.user.screen_name+"/status/"+g.id+"'>"+VMM.ExternalAPI.twitter.prettyParseTwitterDate(g.created_at)+" </a></blockquote></div>";k.content=l;k.raw=g;d.push(k);if(d.length==b){var j={tweetdata:d};VMM.fireEvent(global,"TWEETSLOADED",j)}}).success(function(){trace("second success")}).error(function(){trace("error")}).complete(function(){trace("complete")})}},getTweetSearch:function(e,b){var a=40;if(b!=null&&b!=""){a=b}var c="http://search.twitter.com/search.json?q="+e+"&rpp="+a+"&include_entities=true&result_type=mixed";var d=[];VMM.getJSON(c,function(f){for(var g=0;g<f.results.length;g++){var k={};var l="<div class='twitter'><blockquote><p>";var h=VMM.Util.linkify_with_twitter(f.results[g].text,"_blank");l+=h;l+="</p>";l+="— "+f.results[g].from_user_name+" (<a href='https://twitter.com/"+f.results[g].from_user+"'>@"+f.results[g].from_user+"</a>) <a href='https://twitter.com/"+f.results[g].from_user+"/status/"+f.id+"'>"+VMM.ExternalAPI.twitter.prettyParseTwitterDate(f.results[g].created_at)+" </a></blockquote></div>";k.content=l;k.raw=f.results[g];d.push(k)}var j={tweetdata:d};VMM.fireEvent(global,"TWEETSLOADED",j)})},prettyHTML:function(b,c){var b=b.toString();var a={twitterid:b};var d="http://api.twitter.com/1/statuses/show.json?id="+b+"&include_entities=true&callback=?";var e=setTimeout(VMM.ExternalAPI.twitter.errorTimeOut,VMM.master_config.timers.api,b);VMM.getJSON(d,VMM.ExternalAPI.twitter.formatJSON).error(function(g,h,f){trace("TWITTER error");trace("TWITTER ERROR: "+h+" "+g.responseText);VMM.attachElement("#twitter_"+b,"<p>ERROR LOADING TWEET "+b+"</p>")}).success(function(f){clearTimeout(e);if(c){VMM.ExternalAPI.twitter.secondaryMedia(f)}})},formatJSON:function(a){var b=a.id_str;var e="<blockquote><p>";var c=VMM.Util.linkify_with_twitter(a.text,"_blank");e+=c;e+="</p></blockquote>";e+="<div class='vcard author'>";e+="<a class='screen-name url' href='https://twitter.com/"+a.user.screen_name+"' data-screen-name='"+a.user.screen_name+"' target='_blank'>";e+="<span class='avatar'><img src=' "+a.user.profile_image_url+"'  alt=''></span>";e+="<span class='fn'>"+a.user.name+"</span>";e+="<span class='nickname'>@"+a.user.screen_name+"<span class='thumbnail-inline'></span></span>";e+="</a>";e+="</div>";if(typeof a.entities.media!="undefined"){if(a.entities.media[0].type=="photo"){e+="<img src=' "+a.entities.media[0].media_url+"'  alt=''>"}}VMM.attachElement("#twitter_"+b.toString(),e);VMM.attachElement("#text_thumb_"+b.toString(),a.text)}},googlemaps:{maptype:"toner",setMapType:function(a){if(a!=""){VMM.ExternalAPI.googlemaps.maptype=a}},get:function(b){var d,a,c;b.vars=VMM.Util.getUrlVars(b.id);if(VMM.ExternalAPI.keys.google!=""){a=VMM.ExternalAPI.keys.google}else{a=Aes.Ctr.decrypt(VMM.ExternalAPI.keys_master.google,VMM.ExternalAPI.keys_master.vp,256)}c="http://maps.googleapis.com/maps/api/js?key="+a+"&libraries=places&sensor=false&callback=VMM.ExternalAPI.googlemaps.onMapAPIReady";if(VMM.master_config.googlemaps.active){VMM.master_config.googlemaps.que.push(b)}else{VMM.master_config.googlemaps.que.push(b);if(VMM.master_config.googlemaps.api_loaded){}else{LoadLib.js(c,function(){trace("Google Maps API Library Loaded")})}}},create:function(a){VMM.ExternalAPI.googlemaps.createAPIMap(a)},createiFrameMap:function(b){var a=b.id+"&output=embed",c="",d=b.uid.toString()+"_gmap";c+="<div class='google-map' id='"+d+"' style='width=100%;height=100%;'>";c+="<iframe width='100%' height='100%' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src='"+a+"'></iframe>";c+="</div>";VMM.attachElement("#"+b.uid,c)},createAPIMap:function(l){var o="",f,n,r,t=l.uid.toString()+"_gmap",p="",k=new google.maps.LatLng(41.875696,-87.624207),e,u=11,c=false,d=false,a=false,q;function s(m){if(m in VMM.ExternalAPI.googlemaps.map_providers){o=VMM.ExternalAPI.googlemaps.map_attribution[VMM.ExternalAPI.googlemaps.map_providers[m].attribution];return VMM.ExternalAPI.googlemaps.map_providers[m]}else{if(VMM.ExternalAPI.googlemaps.defaultType(m)){trace("GOOGLE MAP DEFAULT TYPE");return google.maps.MapTypeId[m.toUpperCase()]}else{trace("Not a maptype: "+m)}}}google.maps.VeriteMapType=function(m){if(VMM.ExternalAPI.googlemaps.defaultType(m)){return google.maps.MapTypeId[m.toUpperCase()]}else{var v=s(m);return google.maps.ImageMapType.call(this,{getTileUrl:function(w,z){var y=(z+w.x+w.y)%VMM.ExternalAPI.googlemaps.map_subdomains.length;return[v.url.replace("{S}",VMM.ExternalAPI.googlemaps.map_subdomains[y]).replace("{Z}",z).replace("{X}",w.x).replace("{Y}",w.y).replace("{z}",z).replace("{x}",w.x).replace("{y}",w.y)]},tileSize:new google.maps.Size(256,256),name:m,minZoom:v.minZoom,maxZoom:v.maxZoom})}};google.maps.VeriteMapType.prototype=new google.maps.ImageMapType("_");if(VMM.ExternalAPI.googlemaps.maptype!=""){if(VMM.ExternalAPI.googlemaps.defaultType(VMM.ExternalAPI.googlemaps.maptype)){f=google.maps.MapTypeId[VMM.ExternalAPI.googlemaps.maptype.toUpperCase()]}else{f=VMM.ExternalAPI.googlemaps.maptype}}else{f="toner"}if(type.of(VMM.Util.getUrlVars(l.id)["ll"])=="string"){c=true;e=VMM.Util.getUrlVars(l.id)["ll"].split(",");k=new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))}else{if(type.of(VMM.Util.getUrlVars(l.id)["sll"])=="string"){e=VMM.Util.getUrlVars(l.id)["sll"].split(",");k=new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))}}if(type.of(VMM.Util.getUrlVars(l.id)["z"])=="string"){d=true;u=parseFloat(VMM.Util.getUrlVars(l.id)["z"])}r={zoom:u,draggable:false,disableDefaultUI:true,mapTypeControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},center:k,mapTypeId:f,mapTypeControlOptions:{mapTypeIds:[f]}};VMM.attachElement("#"+l.uid,"<div class='google-map' id='"+t+"' style='width=100%;height=100%;'></div>");n=new google.maps.Map(document.getElementById(t),r);if(VMM.ExternalAPI.googlemaps.defaultType(VMM.ExternalAPI.googlemaps.maptype)){}else{n.mapTypes.set(f,new google.maps.VeriteMapType(f));p="<div class='map-attribution'><div class='attribution-text'>"+o+"</div></div>";VMM.appendElement("#"+t,p)}if(type.of(VMM.Util.getUrlVars(l.id)["msid"])=="string"){g()}else{if(type.of(VMM.Util.getUrlVars(l.id)["q"])=="string"){b()}}function b(){var w=new google.maps.Geocoder(),m=VMM.Util.getUrlVars(l.id)["q"],y;if(m.match("loc:")){var v=m.split(":")[1].split("+");k=new google.maps.LatLng(parseFloat(v[0]),parseFloat(v[1]));c=true}w.geocode({address:m},function(z,A){if(A==google.maps.GeocoderStatus.OK){y=new google.maps.Marker({map:n,position:z[0].geometry.location});if(typeof z[0].geometry.viewport!="undefined"){n.fitBounds(z[0].geometry.viewport)}else{if(typeof z[0].geometry.bounds!="undefined"){n.fitBounds(z[0].geometry.bounds)}else{n.setCenter(z[0].geometry.location)}}if(c){n.panTo(k)}if(d){n.setZoom(u)}}else{trace("Geocode for "+m+" was not successful for the following reason: "+A);trace("TRYING PLACES SEARCH");if(c){n.panTo(k)}if(d){n.setZoom(u)}h()}})}function h(){var z,C,y,B,v,m;place_search=new google.maps.places.PlacesService(n);y=new google.maps.InfoWindow();C={query:"",types:["country","neighborhood","political","locality","geocode"]};if(type.of(VMM.Util.getUrlVars(l.id)["q"])=="string"){C.query=VMM.Util.getUrlVars(l.id)["q"]}if(c){C.location=k;C.radius="15000"}else{v=new google.maps.LatLng(-89.999999,-179.999999);m=new google.maps.LatLng(89.999999,179.999999);B=new google.maps.LatLngBounds(v,m)}place_search.textSearch(C,A);function A(E,F){if(F==google.maps.places.PlacesServiceStatus.OK){for(var D=0;D<E.length;D++){}if(c){n.panTo(k)}else{if(E.length>=1){n.panTo(E[0].geometry.location);if(d){n.setZoom(u)}}}}else{trace("Place search for "+C.query+" was not successful for the following reason: "+F);trace("YOU MAY NEED A GOOGLE MAPS API KEY IN ORDER TO USE THIS FEATURE OF TIMELINEJS");trace("FIND OUT HOW TO GET YOUR KEY HERE: https://developers.google.com/places/documentation/#Authentication");if(c){n.panTo(k);if(d){n.setZoom(u)}}else{trace("USING SIMPLE IFRAME MAP EMBED");if(l.id[0].match("https")){l.id=l.url[0].replace("https","http")}VMM.ExternalAPI.googlemaps.createiFrameMap(l)}}}function w(E){var D,F;F=E.geometry.location;D=new google.maps.Marker({map:n,position:E.geometry.location});google.maps.event.addListener(D,"click",function(){y.setContent(E.name);y.open(n,this)})}}function j(){var m,w,v=false;trace("LOADING PLACES API FOR GOOGLE MAPS");if(VMM.ExternalAPI.keys.google!=""){m=VMM.ExternalAPI.keys.google;v=true}else{trace("YOU NEED A GOOGLE MAPS API KEY IN ORDER TO USE THIS FEATURE OF TIMELINEJS");trace("FIND OUT HOW TO GET YOUR KEY HERE: https://developers.google.com/places/documentation/#Authentication")}w="https://maps.googleapis.com/maps/api/place/textsearch/json?key="+m+"&sensor=false&language="+l.lang+"&";if(type.of(VMM.Util.getUrlVars(l.id)["q"])=="string"){w+="query="+VMM.Util.getUrlVars(l.id)["q"]}if(c){w+="&location="+k}if(v){VMM.getJSON(w,function(y){trace("PLACES JSON");var C="",z="",A="",B="";trace(y);if(y.status=="OVER_QUERY_LIMIT"){trace("OVER_QUERY_LIMIT");if(c){n.panTo(k);if(d){n.setZoom(u)}}else{trace("DOING TRADITIONAL MAP IFRAME EMBED UNTIL QUERY LIMIT RESTORED");a=true;VMM.ExternalAPI.googlemaps.createiFrameMap(l)}}else{if(y.results.length>=1){A=new google.maps.LatLng(parseFloat(y.results[0].geometry.viewport.northeast.lat),parseFloat(y.results[0].geometry.viewport.northeast.lng));B=new google.maps.LatLng(parseFloat(y.results[0].geometry.viewport.southwest.lat),parseFloat(y.results[0].geometry.viewport.southwest.lng));z=new google.maps.LatLngBounds(B,A);n.fitBounds(z)}else{trace("NO RESULTS")}if(c){n.panTo(k)}if(d){n.setZoom(u)}}}).error(function(z,A,y){trace("PLACES JSON ERROR");trace("PLACES JSON ERROR: "+A+" "+z.responseText)}).success(function(y){trace("PLACES JSON SUCCESS")})}else{if(c){n.panTo(k);if(d){n.setZoom(u)}}else{trace("DOING TRADITIONAL MAP IFRAME EMBED BECAUSE NO GOOGLE MAP API KEY WAS PROVIDED");VMM.ExternalAPI.googlemaps.createiFrameMap(l)}}}function g(){var w,v,m,y;w=l.id+"&output=kml";w=w.replace("&output=embed","");v=new google.maps.KmlLayer(w,{preserveViewport:true});m=new google.maps.InfoWindow();v.setMap(n);google.maps.event.addListenerOnce(v,"defaultviewport_changed",function(){if(c){n.panTo(k)}else{n.fitBounds(v.getDefaultViewport())}if(d){n.setZoom(u)}});google.maps.event.addListener(v,"click",function(z){y=z.featureData.description;A(y);function A(B){m.setContent(B);m.open(n)}})}},pushQue:function(){for(var a=0;a<VMM.master_config.googlemaps.que.length;a++){VMM.ExternalAPI.googlemaps.create(VMM.master_config.googlemaps.que[a])}VMM.master_config.googlemaps.que=[]},onMapAPIReady:function(){VMM.master_config.googlemaps.map_active=true;VMM.master_config.googlemaps.places_active=true;VMM.ExternalAPI.googlemaps.onAPIReady()},onPlacesAPIReady:function(){VMM.master_config.googlemaps.places_active=true;VMM.ExternalAPI.googlemaps.onAPIReady()},onAPIReady:function(){if(!VMM.master_config.googlemaps.active){if(VMM.master_config.googlemaps.map_active&&VMM.master_config.googlemaps.places_active){VMM.master_config.googlemaps.active=true;VMM.ExternalAPI.googlemaps.pushQue()}}},defaultType:function(a){if(a.toLowerCase()=="satellite"||a.toLowerCase()=="hybrid"||a.toLowerCase()=="terrain"||a.toLowerCase()=="roadmap"){return true}else{return false}},map_subdomains:["","a.","b.","c.","d."],map_attribution:{stamen:"Map tiles by <a href='http://stamen.com'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org'>OpenStreetMap</a>, under <a href='http://creativecommons.org/licenses/by-sa/3.0'>CC BY SA</a>.",apple:"Map data &copy; 2012  Apple, Imagery &copy; 2012 Apple"},map_providers:{toner:{url:"http://{S}tile.stamen.com/toner/{Z}/{X}/{Y}.png",minZoom:0,maxZoom:20,attribution:"stamen"},"toner-lines":{url:"http://{S}tile.stamen.com/toner-lines/{Z}/{X}/{Y}.png",minZoom:0,maxZoom:20,attribution:"stamen"},"toner-labels":{url:"http://{S}tile.stamen.com/toner-labels/{Z}/{X}/{Y}.png",minZoom:0,maxZoom:20,attribution:"stamen"},sterrain:{url:"http://{S}tile.stamen.com/terrain/{Z}/{X}/{Y}.jpg",minZoom:4,maxZoom:20,attribution:"stamen"},apple:{url:"http://gsp2.apple.com/tile?api=1&style=slideshow&layers=default&lang=en_US&z={z}&x={x}&y={y}&v=9",minZoom:4,maxZoom:14,attribution:"apple"},watercolor:{url:"http://{S}tile.stamen.com/watercolor/{Z}/{X}/{Y}.jpg",minZoom:3,maxZoom:16,attribution:"stamen"}}},googleplus:{get:function(c){var a;var b={user:c.user,activity:c.id,id:c.uid};VMM.master_config.googleplus.que.push(b);VMM.master_config.googleplus.active=true},create:function(h,b){var j="",a="",c="",e="",d="",g,f;googleplus_timeout=setTimeout(VMM.ExternalAPI.googleplus.errorTimeOut,VMM.master_config.timers.api,h),callback_timeout=setTimeout(b,VMM.master_config.timers.api,h);if(VMM.master_config.Timeline.api_keys.google!=""){a=VMM.master_config.Timeline.api_keys.google}else{a=Aes.Ctr.decrypt(VMM.master_config.api_keys_master.google,VMM.master_config.vp,256)}g="https://www.googleapis.com/plus/v1/people/"+h.user+"/activities/public?alt=json&maxResults=100&fields=items(id,url)&key="+a;j="GOOGLE PLUS API CALL";VMM.getJSON(g,function(l){for(var k=0;k<l.items.length;k++){trace("loop");if(l.items[k].url.split("posts/")[1]==h.activity){trace("FOUND IT!!");c=l.items[k].id;f="https://www.googleapis.com/plus/v1/activities/"+c+"?alt=json&key="+a;VMM.getJSON(f,function(m){trace(m);if(typeof m.annotation!="undefined"){e+="<div class='googleplus-annotation'>'"+m.annotation+"</div>";e+=m.object.content}else{e+=m.object.content}if(typeof m.object.attachments!="undefined"){for(var n=0;n<m.object.attachments.length;n++){if(m.object.attachments[n].objectType=="photo"){d="<a href='"+m.object.url+"' target='_blank'><img src='"+m.object.attachments[n].image.url+"' class='article-thumb'></a>"+d}else{if(m.object.attachments[n].objectType=="video"){d="<img src='"+m.object.attachments[n].image.url+"' class='article-thumb'>"+d;d+="<div>";d+="<a href='"+m.object.attachments[n].url+"' target='_blank'>";d+="<h5>"+m.object.attachments[n].displayName+"</h5>";d+="</a>";d+="</div>"}else{if(m.object.attachments[n].objectType=="article"){d+="<div>";d+="<a href='"+m.object.attachments[n].url+"' target='_blank'>";d+="<h5>"+m.object.attachments[n].displayName+"</h5>";d+="<p>"+m.object.attachments[n].content+"</p>";d+="</a>";d+="</div>"}}}trace(m.object.attachments[n])}d="<div class='googleplus-attachments'>"+d+"</div>"}j="<div class='googleplus-content'>"+e+d+"</div>";j+="<div class='vcard author'><a class='screen-name url' href='"+m.url+"' target='_blank'>";j+="<span class='avatar'><img src='"+m.actor.image.url+"' style='max-width: 32px; max-height: 32px;'></span>";j+="<span class='fn'>"+m.actor.displayName+"</span>";j+="<span class='nickname'><span class='thumbnail-inline'></span></span>";j+="</a></div>";VMM.attachElement("#googleplus_"+h.activity,j)});break}}}).error(function(m,n,l){var k=VMM.parseJSON(m.responseText);trace(k.error.message);VMM.attachElement("#googleplus_"+h.activity,VMM.MediaElement.loadingmessage("<p>ERROR LOADING GOOGLE+ </p><p>"+k.error.message+"</p>"))}).success(function(k){clearTimeout(googleplus_timeout);clearTimeout(callback_timeout);b()})},pushQue:function(){if(VMM.master_config.googleplus.que.length>0){VMM.ExternalAPI.googleplus.create(VMM.master_config.googleplus.que[0],VMM.ExternalAPI.googleplus.pushQue);VMM.master_config.googleplus.que.remove(0)}},errorTimeOut:function(a){trace("GOOGLE+ JSON ERROR TIMEOUT "+a.activity);VMM.attachElement("#googleplus_"+a.activity,VMM.MediaElement.loadingmessage("<p>Still waiting on GOOGLE+ </p><p>"+a.activity+"</p>"))}},googledocs:{get:function(a){VMM.master_config.googledocs.que.push(a);VMM.master_config.googledocs.active=true},create:function(a){var b="";if(a.id.match(/docs.google.com/i)){b="<iframe class='doc' frameborder='0' width='100%' height='100%' src='"+a.id+"&amp;embedded=true'></iframe>"}else{b="<iframe class='doc' frameborder='0' width='100%' height='100%' src='http://docs.google.com/viewer?url="+a.id+"&amp;embedded=true'></iframe>"}VMM.attachElement("#"+a.uid,b)},pushQue:function(){for(var a=0;a<VMM.master_config.googledocs.que.length;a++){VMM.ExternalAPI.googledocs.create(VMM.master_config.googledocs.que[a])}VMM.master_config.googledocs.que=[]}},flickr:{get:function(a){VMM.master_config.flickr.que.push(a);VMM.master_config.flickr.active=true},create:function(d,b){var a,c=setTimeout(b,VMM.master_config.timers.api,d);if(typeof VMM.master_config.Timeline!="undefined"&&VMM.master_config.Timeline.api_keys.flickr!=""){a=VMM.master_config.Timeline.api_keys.flickr}else{a=Aes.Ctr.decrypt(VMM.master_config.api_keys_master.flickr,VMM.master_config.vp,256)}var e="http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+a+"&photo_id="+d.id+"&format=json&jsoncallback=?";VMM.getJSON(e,function(f){var h=f.sizes.size[0].url.split("photos/")[1].split("/")[1];var l="#"+d.uid,n="#"+d.uid+"_thumb";var j,k,m=false,g="Large";g=VMM.ExternalAPI.flickr.sizes(VMM.master_config.sizes.api.height);for(var o=0;o<f.sizes.size.length;o++){if(f.sizes.size[o].label==g){m=true;j=f.sizes.size[o].source}}if(!m){j=f.sizes.size[f.sizes.size.length-2].source}k=f.sizes.size[0].source;VMM.Lib.attr(l,"src",j);VMM.attachElement(n,"<img src='"+k+"'>")}).error(function(g,h,f){trace("FLICKR error");trace("FLICKR ERROR: "+h+" "+g.responseText)}).success(function(f){clearTimeout(c);b()})},pushQue:function(){if(VMM.master_config.flickr.que.length>0){VMM.ExternalAPI.flickr.create(VMM.master_config.flickr.que[0],VMM.ExternalAPI.flickr.pushQue);VMM.master_config.flickr.que.remove(0)}},sizes:function(b){var a="";if(b<=75){a="Thumbnail"}else{if(b<=180){a="Small"}else{if(b<=240){a="Small 320"}else{if(b<=375){a="Medium"}else{if(b<=480){a="Medium 640"}else{if(b<=600){a="Large"}else{a="Large"}}}}}}return a}},instagram:{get:function(a,b){if(b){return"http://instagr.am/p/"+a.id+"/media/?size=t"}else{return"http://instagr.am/p/"+a.id+"/media/?size="+VMM.ExternalAPI.instagram.sizes(VMM.master_config.sizes.api.height)}},sizes:function(b){var a="";if(b<=150){a="t"}else{if(b<=306){a="m"}else{a="l"}}return a}},soundcloud:{get:function(a){VMM.master_config.soundcloud.que.push(a);VMM.master_config.soundcloud.active=true},create:function(b,a){var c="http://soundcloud.com/oembed?url="+b.id+"&format=js&callback=?";VMM.getJSON(c,function(e){VMM.attachElement("#"+b.uid,e.html);a()})},pushQue:function(){if(VMM.master_config.soundcloud.que.length>0){VMM.ExternalAPI.soundcloud.create(VMM.master_config.soundcloud.que[0],VMM.ExternalAPI.soundcloud.pushQue);VMM.master_config.soundcloud.que.remove(0)}}},wikipedia:{get:function(a){VMM.master_config.wikipedia.que.push(a);VMM.master_config.wikipedia.active=true},create:function(b,a){var d="http://"+b.lang+".wikipedia.org/w/api.php?action=query&prop=extracts&redirects=&titles="+b.id+"&exintro=1&format=json&callback=?";callback_timeout=setTimeout(a,VMM.master_config.timers.api,b);if(VMM.Browser.browser=="Explorer"&&parseInt(VMM.Browser.version,10)>=7&&window.XDomainRequest){var c="<h4><a href='http://"+VMM.master_config.language.api.wikipedia+".wikipedia.org/wiki/"+b.id+"' target='_blank'>"+b.url+"</a></h4>";c+="<span class='wiki-source'>"+VMM.master_config.language.messages.wikipedia+"</span>";c+="<p>Wikipedia entry unable to load using Internet Explorer 8 or below.</p>";VMM.attachElement("#"+b.uid,c)}VMM.getJSON(d,function(f){if(f.query){var h,m,e="",k="",j=1,l=[];h=VMM.Util.getObjectAttributeByIndex(f.query.pages,0).extract;m=VMM.Util.getObjectAttributeByIndex(f.query.pages,0).title;if(h.match("<p>")){l=h.split("<p>")}else{l.push(h)}for(var g=0;g<l.length;g++){if(g+1<=j&&g+1<l.length){k+="<p>"+l[g+1]}}e="<h4><a href='http://"+VMM.master_config.language.api.wikipedia+".wikipedia.org/wiki/"+m+"' target='_blank'>"+m+"</a></h4>";e+="<span class='wiki-source'>"+VMM.master_config.language.messages.wikipedia+"</span>";e+=VMM.Util.linkify_wikipedia(k);if(h.match("REDIRECT")){}else{VMM.attachElement("#"+b.uid,e)}}}).error(function(f,g,e){trace("WIKIPEDIA error");trace("WIKIPEDIA ERROR: "+g+" "+f.responseText);trace(e);VMM.attachElement("#"+b.uid,VMM.MediaElement.loadingmessage("<p>Wikipedia is not responding</p>"));clearTimeout(callback_timeout);if(VMM.master_config.wikipedia.tries<4){trace("WIKIPEDIA ATTEMPT "+VMM.master_config.wikipedia.tries);trace(b);VMM.master_config.wikipedia.tries++;VMM.ExternalAPI.wikipedia.create(b,a)}else{a()}}).success(function(e){VMM.master_config.wikipedia.tries=0;clearTimeout(callback_timeout);a()})},pushQue:function(){if(VMM.master_config.wikipedia.que.length>0){trace("WIKIPEDIA PUSH QUE "+VMM.master_config.wikipedia.que.length);VMM.ExternalAPI.wikipedia.create(VMM.master_config.wikipedia.que[0],VMM.ExternalAPI.wikipedia.pushQue);VMM.master_config.wikipedia.que.remove(0)}}},youtube:{get:function(a){var b="http://gdata.youtube.com/feeds/api/videos/"+a.id+"?v=2&alt=jsonc&callback=?";VMM.master_config.youtube.que.push(a);if(!VMM.master_config.youtube.active){if(!VMM.master_config.youtube.api_loaded){LoadLib.js("http://www.youtube.com/player_api",function(){trace("YouTube API Library Loaded")})}}VMM.getJSON(b,function(c){VMM.ExternalAPI.youtube.createThumb(c,a)})},create:function(a){if(typeof(a.start)!="undefined"){var e=a.start.toString(),c=0,d=0;if(e.match("m")){c=parseInt(e.split("m")[0],10);d=parseInt(e.split("m")[1].split("s")[0],10);a.start=(c*60)+d}else{a.start=0}}else{a.start=0}var b={active:false,player:{},name:a.uid,playing:false,hd:false};if(typeof(a.hd)!="undefined"){b.hd=true}b.player[a.id]=new YT.Player(a.uid,{height:"390",width:"640",playerVars:{enablejsapi:1,color:"white",showinfo:0,theme:"light",start:a.start,rel:0},videoId:a.id,events:{onReady:VMM.ExternalAPI.youtube.onPlayerReady,onStateChange:VMM.ExternalAPI.youtube.onStateChange}});VMM.master_config.youtube.array.push(b)},createThumb:function(a,b){trace("CREATE THUMB");trace(a);trace(b);if(typeof a.data!="undefined"){var c="#"+b.uid+"_thumb";VMM.attachElement(c,"<img src='"+a.data.thumbnail.sqDefault+"'>")}},pushQue:function(){for(var a=0;a<VMM.master_config.youtube.que.length;a++){VMM.ExternalAPI.youtube.create(VMM.master_config.youtube.que[a])}VMM.master_config.youtube.que=[]},onAPIReady:function(){VMM.master_config.youtube.active=true;VMM.ExternalAPI.youtube.pushQue()},stopPlayers:function(){for(var a=0;a<VMM.master_config.youtube.array.length;a++){if(VMM.master_config.youtube.array[a].playing){var b=VMM.master_config.youtube.array[a].name;VMM.master_config.youtube.array[a].player[b].stopVideo()}}},onStateChange:function(a){for(var b=0;b<VMM.master_config.youtube.array.length;b++){var c=VMM.master_config.youtube.array[b].name;if(VMM.master_config.youtube.array[b].player[c]==a.target){if(a.data==YT.PlayerState.PLAYING){VMM.master_config.youtube.array[b].playing=true;trace(VMM.master_config.youtube.array[b].hd);if(VMM.master_config.youtube.array[b].hd){}}}}},onPlayerReady:function(a){}},vimeo:{get:function(a){VMM.master_config.vimeo.que.push(a);VMM.master_config.vimeo.active=true},create:function(b,a){trace("VIMEO CREATE");var c="http://vimeo.com/api/v2/video/"+b.id+".json",d="http://player.vimeo.com/video/"+b.id+"?title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff";VMM.getJSON(c,function(e){VMM.ExternalAPI.vimeo.createThumb(e,b);a()});VMM.attachElement("#"+b.uid,"<iframe autostart='false' frameborder='0' width='100%' height='100%' src='"+d+"'></iframe>")},createThumb:function(a,b){trace("VIMEO CREATE THUMB");var c="#"+b.uid+"_thumb";VMM.attachElement(c,"<img src='"+a[0].thumbnail_small+"'>")},pushQue:function(){if(VMM.master_config.vimeo.que.length>0){VMM.ExternalAPI.vimeo.create(VMM.master_config.vimeo.que[0],VMM.ExternalAPI.vimeo.pushQue);VMM.master_config.vimeo.que.remove(0)}}},webthumb:{get:function(a,b){VMM.master_config.webthumb.que.push(a);VMM.master_config.webthumb.active=true},sizes:function(b){var a="";if(b<=150){a="t"}else{if(b<=306){a="m"}else{a="l"}}return a},create:function(a){trace("WEB THUMB CREATE");var b="http://free.pagepeeker.com/v2/thumbs.php?";url=a.id.replace("http://","");VMM.attachElement("#"+a.uid,"<a href='"+a.id+"' target='_blank'><img src='"+b+"size=x&url="+url+"'></a>");VMM.attachElement("#"+a.uid+"_thumb","<a href='"+a.id+"' target='_blank'><img src='"+b+"size=t&url="+url+"'></a>")},pushQue:function(){for(var a=0;a<VMM.master_config.webthumb.que.length;a++){VMM.ExternalAPI.webthumb.create(VMM.master_config.webthumb.que[a])}VMM.master_config.webthumb.que=[]}}}).init()}function onYouTubePlayerAPIReady(){trace("GLOBAL YOUTUBE API CALLED");VMM.ExternalAPI.youtube.onAPIReady()}if(typeof VMM!="undefined"&&typeof VMM.MediaElement=="undefined"){VMM.MediaElement=({init:function(){return this},loadingmessage:function(a){return"<div class='vco-loading'><div class='vco-loading-container'><div class='vco-loading-icon'></div><div class='vco-message'><p>"+a+"</p></div></div></div>"},thumbnail:function(e,l,f,k){var d=16,a=24,b="";if(l!=null&&l!=""){d=l}if(f!=null&&f!=""){a=f}if(k!=null&&k!=""){b=k}if(e.media!=null&&e.media!=""){var c=true,j="",g=VMM.MediaType(e.media);if(e.thumbnail!=null&&e.thumbnail!=""){trace("CUSTOM THUMB");j="<div class='thumbnail thumb-custom' id='"+k+"_custom_thumb'><img src='"+e.thumbnail+"'></div>";return j}else{if(g.type=="image"){j="<div class='thumbnail thumb-photo'></div>";return j}else{if(g.type=="flickr"){j="<div class='thumbnail thumb-photo' id='"+k+"_thumb'></div>";return j}else{if(g.type=="instagram"){j="<div class='thumbnail thumb-instagram' id='"+k+"_thumb'><img src='"+VMM.ExternalAPI.instagram.get(g.id,true)+"'></div>";return j}else{if(g.type=="youtube"){j="<div class='thumbnail thumb-youtube' id='"+k+"_thumb'></div>";return j}else{if(g.type=="googledoc"){j="<div class='thumbnail thumb-document'></div>";return j}else{if(g.type=="vimeo"){j="<div class='thumbnail thumb-vimeo' id='"+k+"_thumb'></div>";return j}else{if(g.type=="dailymotion"){j="<div class='thumbnail thumb-video'></div>";return j}else{if(g.type=="twitter"){j="<div class='thumbnail thumb-twitter'></div>";return j}else{if(g.type=="twitter-ready"){j="<div class='thumbnail thumb-twitter'></div>";return j}else{if(g.type=="soundcloud"){j="<div class='thumbnail thumb-audio'></div>";return j}else{if(g.type=="google-map"){j="<div class='thumbnail thumb-map'></div>";return j}else{if(g.type=="googleplus"){j="<div class='thumbnail thumb-googleplus'></div>";return j}else{if(g.type=="wikipedia"){j="<div class='thumbnail thumb-wikipedia'></div>";return j}else{if(g.type=="storify"){j="<div class='thumbnail thumb-storify'></div>";return j}else{if(g.type=="quote"){j="<div class='thumbnail thumb-quote'></div>";return j}else{if(g.type=="unknown"){if(g.id.match("blockquote")){j="<div class='thumbnail thumb-quote'></div>"}else{j="<div class='thumbnail thumb-plaintext'></div>"}return j}else{if(g.type=="website"){j="<div class='thumbnail thumb-website' id='"+k+"_thumb'></div>";return j}else{j="<div class='thumbnail thumb-plaintext'></div>";return j}}}}}}}}}}}}}}}}}}}},create:function(e,k){var b=false,g=VMM.MediaElement.loadingmessage(VMM.master_config.language.messages.loading+"...");if(e.media!=null&&e.media!=""){var j="",c="",d="",a="",f=false,h;h=VMM.MediaType(e.media);h.uid=k;b=true;if(e.credit!=null&&e.credit!=""){d="<div class='credit'>"+VMM.Util.linkify_with_twitter(e.credit,"_blank")+"</div>"}if(e.caption!=null&&e.caption!=""){c="<div class='caption'>"+VMM.Util.linkify_with_twitter(e.caption,"_blank")+"</div>"}if(h.type=="image"){if(h.id.match("https://")){h.id=h.id.replace("https://","http://")}j="<div class='media-image media-shadow'><img src='"+h.id+"' class='media-image'></div>"}else{if(h.type=="flickr"){j="<div class='media-image media-shadow'><a href='"+h.link+"' target='_blank'><img id='"+k+"'></a></div>";VMM.ExternalAPI.flickr.get(h)}else{if(h.type=="instagram"){j="<div class='media-image media-shadow'><a href='"+h.link+"' target='_blank'><img src='"+VMM.ExternalAPI.instagram.get(h)+"'></a></div>"}else{if(h.type=="googledoc"){j="<div class='media-frame media-shadow doc' id='"+h.uid+"'>"+g+"</div>";VMM.ExternalAPI.googledocs.get(h)}else{if(h.type=="youtube"){j="<div class='media-shadow'><div class='media-frame video youtube' id='"+h.uid+"'>"+g+"</div></div>";VMM.ExternalAPI.youtube.get(h)}else{if(h.type=="vimeo"){j="<div class='media-shadow media-frame video vimeo' id='"+h.uid+"'>"+g+"</div>";VMM.ExternalAPI.vimeo.get(h)}else{if(h.type=="dailymotion"){j="<div class='media-shadow'><iframe class='media-frame video dailymotion' autostart='false' frameborder='0' width='100%' height='100%' src='http://www.dailymotion.com/embed/video/"+h.id+"'></iframe></div>"}else{if(h.type=="twitter"){j="<div class='twitter' id='"+h.uid+"'>"+g+"</div>";f=true;VMM.ExternalAPI.twitter.get(h)}else{if(h.type=="twitter-ready"){f=true;j=h.id}else{if(h.type=="soundcloud"){j="<div class='media-frame media-shadow soundcloud' id='"+h.uid+"'>"+g+"</div>";VMM.ExternalAPI.soundcloud.get(h)}else{if(h.type=="google-map"){j="<div class='media-frame media-shadow map' id='"+h.uid+"'>"+g+"</div>";VMM.ExternalAPI.googlemaps.get(h)}else{if(h.type=="googleplus"){a="googleplus_"+h.id;j="<div class='googleplus' id='"+a+"'>"+g+"</div>";f=true;VMM.ExternalAPI.googleplus.get(h)}else{if(h.type=="wikipedia"){j="<div class='wikipedia' id='"+h.uid+"'>"+g+"</div>";f=true;VMM.ExternalAPI.wikipedia.get(h)}else{if(h.type=="storify"){f=true;j="<div class='plain-text-quote'>"+h.id+"</div>"}else{if(h.type=="quote"){f=true;j="<div class='plain-text-quote'>"+h.id+"</div>"}else{if(h.type=="unknown"){trace("NO KNOWN MEDIA TYPE FOUND TRYING TO JUST PLACE THE HTML");f=true;j="<div class='plain-text'><div class='container'>"+VMM.Util.properQuotes(h.id)+"</div></div>"}else{if(h.type=="website"){j="<div class='media-shadow website' id='"+h.uid+"'>"+g+"</div>";VMM.ExternalAPI.webthumb.get(h)}else{trace("NO KNOWN MEDIA TYPE FOUND");trace(h.type)}}}}}}}}}}}}}}}}}j="<div class='media-container' >"+j+d+c+"</div>";if(f){return"<div class='text-media'><div class='media-wrapper'>"+j+"</div></div>"}else{return"<div class='media-wrapper'>"+j+"</div>"}}}}).init()}if(typeof VMM!="undefined"&&typeof VMM.MediaType=="undefined"){VMM.MediaType=function(a){var b=a.replace(/^\s\s*/,"").replace(/\s\s*$/,""),e=false,c={type:"unknown",id:"",start:0,hd:false,link:"",lang:VMM.Language.lang,uniqueid:VMM.Util.unique_ID(6)};if(b.match("div class='twitter'")){c.type="twitter-ready";c.id=b;e=true}else{if(b.match("(www.)?youtube|youtu.be")){if(b.match("v=")){c.id=VMM.Util.getUrlVars(b)["v"]}else{if(b.match("/embed/")){c.id=b.split("embed/")[1].split(/[?&]/)[0]}else{if(b.match(/v\/|v=|youtu\.be\//)){c.id=b.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0]}else{trace("YOUTUBE IN URL BUT NOT A VALID VIDEO")}}}c.start=VMM.Util.getUrlVars(b)["t"];c.hd=VMM.Util.getUrlVars(b)["hd"];c.type="youtube";e=true}else{if(b.match("(player.)?vimeo.com")){c.type="vimeo";c.id=b.split(/video\/|\/\/vimeo\.com\//)[1].split(/[?&]/)[0];e=true}else{if(b.match("(www.)?dailymotion.com")){c.id=b.split(/video\/|\/\/dailymotion\.com\//)[1];c.type="dailymotion";e=true}else{if(b.match("(player.)?soundcloud.com")){c.type="soundcloud";c.id=b;e=true}else{if(b.match("(www.)?twitter.com")&&b.match("status")){if(b.match("status/")){c.id=b.split("status/")[1]}else{if(b.match("statuses/")){c.id=b.split("statuses/")[1]}else{c.id=""}}c.type="twitter";e=true}else{if(b.match("maps.google")&&!b.match("staticmap")){c.type="google-map";c.id=b.split(/src=['|"][^'|"]*?['|"]/gi);e=true}else{if(b.match("plus.google")){c.type="googleplus";c.id=b.split("/posts/")[1];if(b.split("/posts/")[0].match("u/0/")){c.user=b.split("u/0/")[1].split("/posts")[0]}else{c.user=b.split("google.com/")[1].split("/posts/")[0]}e=true}else{if(b.match("flickr.com/photos")){c.type="flickr";c.id=b.split("photos/")[1].split("/")[1];c.link=b;e=true}else{if(b.match("instagr.am/p/")){c.type="instagram";c.link=b;c.id=b.split("/p/")[1].split("/")[0];e=true}else{if(b.match(/jpg|jpeg|png|gif/i)||b.match("staticmap")||b.match("yfrog.com")||b.match("twitpic.com")||b.match("BlogImage.ashx")){c.type="image";c.id=b;e=true}else{if(VMM.FileExtention.googleDocType(b)){c.type="googledoc";c.id=b;e=true}else{if(b.match("(www.)?wikipedia.org")){c.type="wikipedia";var f=b.split("wiki/")[1].split("#")[0].replace("_"," ");c.id=f.replace(" ","%20");c.lang=b.split("//")[1].split(".wikipedia")[0];e=true}else{if(b.indexOf("http://")==0){c.type="website";c.id=b;e=true}else{if(b.match("storify")){c.type="storify";c.id=b;e=true}else{if(b.match("blockquote")){c.type="quote";c.id=b;e=true}else{trace("unknown media");c.type="unknown";c.id=b;e=true}}}}}}}}}}}}}}}}if(e){return c}else{trace("No valid media id detected");trace(b)}return false}}if(typeof VMM!="undefined"&&typeof VMM.TextElement=="undefined"){VMM.TextElement=({init:function(){return this},create:function(a){return a}}).init()}if(typeof VMM!="undefined"&&typeof VMM.DragSlider=="undefined"){VMM.DragSlider=function(){var a={element:"",element_move:"",constraint:"",sliding:false,pagex:{start:0,end:0},left:{start:0,end:0},time:{start:0,end:0},touch:false,ease:"easeOutExpo"},c={down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},l={down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},q={down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},f=this,j=false;this.createPanel=function(s,t,r,v,u){a.element=s;a.element_move=t;if(u!=null&&u!=""){j=u}if(r!=null&&r!=""){a.constraint=r}else{a.constraint=false}if(v){a.touch=v}else{a.touch=false}trace("TOUCH"+a.touch);if(a.touch){c=q}else{c=l}k(a.element,a.element_move)};this.updateConstraint=function(r){trace("updateConstraint");a.constraint=r};this.cancelSlide=function(r){VMM.unbindEvent(a.element,o,c.move);return true};function k(r,s){VMM.bindEvent(r,p,c.down,{element:s,delement:r});VMM.bindEvent(r,m,c.up,{element:s,delement:r});VMM.bindEvent(r,n,c.leave,{element:s,delement:r})}function n(r){VMM.unbindEvent(r.data.delement,o,c.move);if(!a.touch){r.preventDefault()}r.stopPropagation();if(a.sliding){a.sliding=false;b(r.data.element,r.data.delement,r);return false}else{return true}}function p(r){g(r.data.element,r.data.delement,r);if(!a.touch){r.preventDefault()}r.stopPropagation();return true}function m(r){if(!a.touch){r.preventDefault()}r.stopPropagation();if(a.sliding){a.sliding=false;b(r.data.element,r.data.delement,r);return false}else{return true}}function o(r){e(r.data.element,r);return false}function g(t,r,s){if(a.touch){trace("IS TOUCH");VMM.Lib.css(t,"-webkit-transition-duration","0");a.pagex.start=s.originalEvent.touches[0].screenX}else{a.pagex.start=s.pageX}a.left.start=h(t);a.time.start=new Date().getTime();VMM.Lib.stop(t);VMM.bindEvent(r,o,c.move,{element:t})}function b(t,r,s){VMM.unbindEvent(r,o,c.move);d(t,s)}function e(t,s){var r;a.sliding=true;if(a.touch){a.pagex.end=s.originalEvent.touches[0].screenX}else{a.pagex.end=s.pageX}a.left.end=h(t);r=-(a.pagex.start-a.pagex.end-a.left.start);if(Math.abs(r-a.left.start)>10){VMM.Lib.css(t,"left",r);s.preventDefault();s.stopPropagation()}}function d(t,s){var r={left:a.left.end,left_adjust:0,change:{x:0},time:(new Date().getTime()-a.time.start)*10,time_adjust:(new Date().getTime()-a.time.start)*10},u=3000;if(a.touch){u=6000}r.change.x=u*(Math.abs(a.pagex.end)-Math.abs(a.pagex.start));r.left_adjust=Math.round(r.change.x/r.time);r.left=Math.min(r.left+r.left_adjust);if(a.constraint){if(r.left>a.constraint.left){r.left=a.constraint.left;if(r.time>5000){r.time=5000}}else{if(r.left<a.constraint.right){r.left=a.constraint.right;if(r.time>5000){r.time=5000}}}}VMM.fireEvent(f,"DRAGUPDATE",[r]);if(!j){if(r.time>0){if(a.touch){VMM.Lib.animate(t,r.time,"easeOutCirc",{left:r.left})}else{VMM.Lib.animate(t,r.time,a.ease,{left:r.left})}}}}function h(r){return parseInt(VMM.Lib.css(r,"left").substring(0,VMM.Lib.css(r,"left").length-2),10)}}}if(typeof VMM!="undefined"&&typeof VMM.Slider=="undefined"){VMM.Slider=function(H,I){var m,T,c,e,d,f,a,b,s={},q=[],R=[],Q=[],S="",o=0,p=960,U={move:false,x:10,y:0,off:0,dampen:48},n="",g=false,w=H,y={nextBtn:"",prevBtn:"",nextDate:"",prevDate:"",nextTitle:"",prevTitle:""};if(typeof I!="undefined"){m=I}else{m={preload:4,current_slide:0,interval:10,something:0,width:720,height:400,ease:"easeInOutExpo",duration:1000,timeline:false,spacing:15,slider:{width:720,height:400,content:{width:720,height:400,padding:120,padding_default:120},nav:{width:100,height:200}}}}this.ver="0.6";m.slider.width=m.width;m.slider.height=m.height;this.init=function(W){R=[];Q=[];if(typeof W!="undefined"){this.setData(W)}else{trace("WAITING ON DATA")}};this.width=function(W){if(W!=null&&W!=""){m.slider.width=W;M()}else{return m.slider.width}};this.height=function(W){if(W!=null&&W!=""){m.slider.height=W;M()}else{return m.slider.height}};this.setData=function(W){if(typeof W!="undefined"){q=W;j()}else{trace("NO DATA")}};this.getData=function(){return q};this.setConfig=function(W){if(typeof W!="undefined"){m=W}else{trace("NO CONFIG DATA")}};this.getConfig=function(){return m};this.setSize=function(X,W){if(X!=null){m.slider.width=X}if(W!=null){m.slider.height=W}if(g){M()}};this.active=function(){return g};this.getCurrentNumber=function(){return o};this.setSlide=function(W){u(W)};function z(){trace("onConfigSet")}function M(Z,Y){var X=true,W=false;if(Z!=null){X=Z}if(Y!=null){W=Y}p=m.slider.width;m.slider.nav.height=VMM.Lib.height(y.prevBtnContainer);if(VMM.Browser.device=="mobile"||p<=640){m.slider.content.padding=10}else{m.slider.content.padding=m.slider.content.padding_default}m.slider.content.width=p-(m.slider.content.padding*2);VMM.Lib.width(f,(R.length*m.slider.content.width));if(W){VMM.Lib.css(d,"left",R[o].leftpos())}P();J();VMM.Lib.css(y.nextBtn,"left",(p-m.slider.nav.width));VMM.Lib.height(y.prevBtn,m.slider.height);VMM.Lib.height(y.nextBtn,m.slider.height);VMM.Lib.css(y.nextBtnContainer,"top",((m.slider.height/2)-(m.slider.nav.height/2))+10);VMM.Lib.css(y.prevBtnContainer,"top",((m.slider.height/2)-(m.slider.nav.height/2))+10);VMM.Lib.height(e,m.slider.height);VMM.Lib.width(e,p);if(X){u(o,"linear",1)}if(o==0){VMM.Lib.visible(y.prevBtn,false)}}function A(X,W){trace("DRAG FINISH");trace(W.left_adjust);trace((m.slider.width/2));if(W.left_adjust<0){if(Math.abs(W.left_adjust)>(m.slider.width/2)){if(o==R.length-1){h()}else{u(o+1,"easeOutExpo");V()}}else{h()}}else{if(Math.abs(W.left_adjust)>(m.slider.width/2)){if(o==0){h()}else{u(o-1,"easeOutExpo");V()}}else{h()}}}function D(W){if(o==R.length-1){h()}else{u(o+1);V()}}function E(W){if(o==0){h()}else{u(o-1);V()}}function C(W){switch(W.keyCode){case 39:D(W);break;case 37:E(W);break}}function F(Z,Y){if(Q.length==0){for(var aa=0;aa<R.length;aa++){Q.push(R[aa].leftpos())}}if(typeof Y.left=="number"){var W=Y.left;var X=-(R[o].leftpos());if(W<X-(m.slider_width/3)){D()}else{if(W>X+(m.slider_width/3)){E()}else{VMM.Lib.animate(d,m.duration,m.ease,{left:X})}}}else{VMM.Lib.animate(d,m.duration,m.ease,{left:X})}if(typeof Y.top=="number"){VMM.Lib.animate(d,m.duration,m.ease,{top:-Y.top})}else{}}function B(W){r()}function V(){m.current_slide=o;VMM.fireEvent(w,"UPDATE")}function t(W){q=W}function l(X){var Y=0;VMM.attachElement(f,"");R=[];for(Y=0;Y<X.length;Y++){var W=new VMM.Slider.Slide(X[Y],f);R.push(W)}}function K(X){var W=0;if(X){L()}else{for(W=0;W<R.length;W++){R[W].clearTimers()}T=setTimeout(L,m.duration)}}function L(){var W=0;for(W=0;W<R.length;W++){R[W].enqueue=true}for(W=0;W<m.preload;W++){if(!((o+W)>R.length-1)){R[o+W].show();R[o+W].enqueue=false}if(!((o-W)<0)){R[o-W].show();R[o-W].enqueue=false}}if(R.length>50){for(W=0;W<R.length;W++){if(R[W].enqueue){R[W].hide()}}}P()}function O(W){}function P(){var W=0,ab=".slider-item .layout-text-media .media .media-container ",aa=".slider-item .layout-media .media .media-container ",Y=".slider-item .media .media-container",Z=".slider-item .media .media-container .media-shadow .caption",X=false,ac={text_media:{width:(m.slider.content.width/100)*60,height:m.slider.height-60,video:{width:0,height:0},text:{width:((m.slider.content.width/100)*40)-30,height:m.slider.height}},media:{width:m.slider.content.width,height:m.slider.height-110,video:{width:0,height:0}}};if(VMM.Browser.device=="mobile"||p<641){X=true}VMM.master_config.sizes.api.width=ac.media.width;VMM.master_config.sizes.api.height=ac.media.height;ac.text_media.video=VMM.Util.ratio.fit(ac.text_media.width,ac.text_media.height,16,9);ac.media.video=VMM.Util.ratio.fit(ac.media.width,ac.media.height,16,9);VMM.Lib.css(".slider-item","width",m.slider.content.width);VMM.Lib.height(".slider-item",m.slider.height);if(X){ac.text_media.width=m.slider.content.width-(m.slider.content.padding*2);ac.media.width=m.slider.content.width-(m.slider.content.padding*2);ac.text_media.height=((m.slider.height/100)*50)-50;ac.media.height=((m.slider.height/100)*70)-40;ac.text_media.video=VMM.Util.ratio.fit(ac.text_media.width,ac.text_media.height,16,9);ac.media.video=VMM.Util.ratio.fit(ac.media.width,ac.media.height,16,9);VMM.Lib.css(".slider-item .layout-text-media .text","width","100%");VMM.Lib.css(".slider-item .layout-text-media .text","display","block");VMM.Lib.css(".slider-item .layout-text-media .text .container","display","block");VMM.Lib.css(".slider-item .layout-text-media .text .container","width",ac.media.width);VMM.Lib.css(".slider-item .layout-text-media .text .container .start","width","auto");VMM.Lib.css(".slider-item .layout-text-media .media","float","none");VMM.Lib.addClass(".slider-item .content-container","pad-top");VMM.Lib.css(".slider-item .media blockquote p","line-height","18px");VMM.Lib.css(".slider-item .media blockquote p","font-size","16px");VMM.Lib.css(".slider-item","overflow-y","auto")}else{VMM.Lib.css(".slider-item .layout-text-media .text","width","40%");VMM.Lib.css(".slider-item .layout-text-media .text","display","table-cell");VMM.Lib.css(".slider-item .layout-text-media .text .container","display","table-cell");VMM.Lib.css(".slider-item .layout-text-media .text .container","width","auto");VMM.Lib.css(".slider-item .layout-text-media .text .container .start","width",ac.text_media.text.width);VMM.Lib.removeClass(".slider-item .content-container","pad-top");VMM.Lib.css(".slider-item .layout-text-media .media","float","left");VMM.Lib.css(".slider-item .layout-text-media","display","table");VMM.Lib.css(".slider-item .media blockquote p","line-height","36px");VMM.Lib.css(".slider-item .media blockquote p","font-size","28px");VMM.Lib.css(".slider-item","display","table");VMM.Lib.css(".slider-item","overflow-y","auto")}VMM.Lib.css(ab+".media-frame","max-width",ac.text_media.width);VMM.Lib.height(ab+".media-frame",ac.text_media.height);VMM.Lib.width(ab+".media-frame",ac.text_media.width);VMM.Lib.css(ab+"img","max-height",ac.text_media.height);VMM.Lib.css(aa+"img","max-height",ac.media.height);VMM.Lib.css(ab+"img","max-width",ac.text_media.width);VMM.Lib.css(ab+".avatar img","max-width",32);VMM.Lib.css(ab+".avatar img","max-height",32);VMM.Lib.css(aa+".avatar img","max-width",32);VMM.Lib.css(aa+".avatar img","max-height",32);VMM.Lib.css(ab+".article-thumb","max-width","50%");VMM.Lib.css(aa+".article-thumb","max-width",200);VMM.Lib.width(ab+".media-frame",ac.text_media.video.width);VMM.Lib.height(ab+".media-frame",ac.text_media.video.height);VMM.Lib.width(aa+".media-frame",ac.media.video.width);VMM.Lib.height(aa+".media-frame",ac.media.video.height);VMM.Lib.css(aa+".media-frame","max-height",ac.media.video.height);VMM.Lib.css(aa+".media-frame","max-width",ac.media.video.width);VMM.Lib.height(aa+".soundcloud",168);VMM.Lib.height(ab+".soundcloud",168);VMM.Lib.width(aa+".soundcloud",ac.media.width);VMM.Lib.width(ab+".soundcloud",ac.text_media.width);VMM.Lib.css(Y+".soundcloud","max-height",168);VMM.Lib.height(ab+".map",ac.text_media.height);VMM.Lib.width(ab+".map",ac.text_media.width);VMM.Lib.css(aa+".map","max-height",ac.media.height);VMM.Lib.width(aa+".map",ac.media.width);VMM.Lib.height(ab+".doc",ac.text_media.height);VMM.Lib.width(ab+".doc",ac.text_media.width);VMM.Lib.height(aa+".doc",ac.media.height);VMM.Lib.width(aa+".doc",ac.media.width);VMM.Lib.width(aa+".wikipedia",ac.media.width);VMM.Lib.width(aa+".twitter",ac.media.width);VMM.Lib.width(aa+".plain-text-quote",ac.media.width);VMM.Lib.width(aa+".plain-text",ac.media.width);VMM.Lib.css(Y,"max-width",ac.media.width);VMM.Lib.css(ab+".caption","max-width",ac.text_media.video.width);VMM.Lib.css(aa+".caption","max-width",ac.media.video.width);for(W=0;W<R.length;W++){R[W].layout(X);if(R[W].content_height()>m.slider.height+20){R[W].css("display","block")}else{R[W].css("display","table")}}}function J(){var X=0,W=0;for(W=0;W<R.length;W++){X=W*(m.slider.width+m.spacing);R[W].leftpos(X)}}function G(Y){var W="linear",X=0;for(X=0;X<R.length;X++){if(X==o){R[X].animate(m.duration,W,{opacity:1})}else{if(X==o-1||X==o+1){R[X].animate(m.duration,W,{opacity:0.1})}else{R[X].opacity(Y)}}}}function u(ah,ab,aa,ad,ae){var X=m.ease,W=m.duration,ag=false,af=false,Z="",Y;VMM.ExternalAPI.youtube.stopPlayers();o=ah;Y=R[o].leftpos();if(o==0){af=true}if(o+1>=R.length){ag=true}if(ab!=null&&ab!=""){X=ab}if(aa!=null&&aa!=""){W=aa}if(VMM.Browser.device=="mobile"){VMM.Lib.visible(y.prevBtn,false);VMM.Lib.visible(y.nextBtn,false)}else{if(af){VMM.Lib.visible(y.prevBtn,false)}else{VMM.Lib.visible(y.prevBtn,true);Z=VMM.Util.unlinkify(q[o-1].title);if(m.type=="timeline"){if(typeof q[o-1].date==="undefined"){VMM.attachElement(y.prevDate,Z);VMM.attachElement(y.prevTitle,"")}else{VMM.attachElement(y.prevDate,VMM.Date.prettyDate(q[o-1].startdate,false,q[o-1].precisiondate));VMM.attachElement(y.prevTitle,Z)}}else{VMM.attachElement(y.prevTitle,Z)}}if(ag){VMM.Lib.visible(y.nextBtn,false)}else{VMM.Lib.visible(y.nextBtn,true);Z=VMM.Util.unlinkify(q[o+1].title);if(m.type=="timeline"){if(typeof q[o+1].date==="undefined"){VMM.attachElement(y.nextDate,Z);VMM.attachElement(y.nextTitle,"")}else{VMM.attachElement(y.nextDate,VMM.Date.prettyDate(q[o+1].startdate,false,q[o+1].precisiondate));VMM.attachElement(y.nextTitle,Z)}}else{VMM.attachElement(y.nextTitle,Z)}}}if(ad){VMM.Lib.css(d,"left",-(Y-m.slider.content.padding))}else{VMM.Lib.stop(d);VMM.Lib.animate(d,W,X,{left:-(Y-m.slider.content.padding)})}if(ae){VMM.fireEvent(w,"LOADED")}if(R[o].height()>m.slider_height){VMM.Lib.css(".slider","overflow-y","scroll")}else{VMM.Lib.css(w,"overflow-y","hidden");var ai=0;try{ai=VMM.Lib.prop(w,"scrollHeight");VMM.Lib.animate(w,W,X,{scrollTop:ai-VMM.Lib.height(w)})}catch(ac){ai=VMM.Lib.height(w)}}K();VMM.fireEvent(c,"MESSAGE","TEST")}function h(){VMM.Lib.stop(d);VMM.Lib.animate(d,m.duration,"easeOutExpo",{left:-(R[o].leftpos())+m.slider.content.padding})}function N(W,X,Y){trace("showMessege "+X);VMM.attachElement(b,"<div class='vco-explainer'><div class='vco-explainer-container'><div class='vco-bezel'><div class='vco-gesture-icon'></div><div class='vco-message'><p>"+X+"</p></div></div></div></div>")}function v(){VMM.Lib.animate(b,m.duration,m.ease,{opacity:0},r)}function r(){VMM.Lib.detach(b)}function k(){var W="<div class='icon'>&nbsp;</div>";y.nextBtn=VMM.appendAndGetElement(c,"<div>","nav-next");y.prevBtn=VMM.appendAndGetElement(c,"<div>","nav-previous");y.nextBtnContainer=VMM.appendAndGetElement(y.nextBtn,"<div>","nav-container",W);y.prevBtnContainer=VMM.appendAndGetElement(y.prevBtn,"<div>","nav-container",W);if(m.type=="timeline"){y.nextDate=VMM.appendAndGetElement(y.nextBtnContainer,"<div>","date","");y.prevDate=VMM.appendAndGetElement(y.prevBtnContainer,"<div>","date","")}y.nextTitle=VMM.appendAndGetElement(y.nextBtnContainer,"<div>","title","");y.prevTitle=VMM.appendAndGetElement(y.prevBtnContainer,"<div>","title","");VMM.bindEvent(".nav-next",D);VMM.bindEvent(".nav-previous",E);VMM.bindEvent(window,C,"keydown")}function j(){var W=3000;VMM.attachElement(w,"");c=VMM.getElement(w);e=VMM.appendAndGetElement(c,"<div>","slider-container-mask");d=VMM.appendAndGetElement(e,"<div>","slider-container");f=VMM.appendAndGetElement(d,"<div>","slider-item-container");k();l(q);if(VMM.Browser.device=="tablet"||VMM.Browser.device=="mobile"){m.duration=500;W=1000;a=new VMM.DragSlider();a.createPanel(c,d,"",m.touch,true);VMM.bindEvent(a,A,"DRAGUPDATE");b=VMM.appendAndGetElement(e,"<div>","vco-feedback","");N(null,"Swipe to Navigate");VMM.Lib.height(b,m.slider.height);VMM.bindEvent(b,B);VMM.bindEvent(b,B,"touchend")}M(false,true);VMM.Lib.visible(y.prevBtn,false);u(m.current_slide,"easeOutExpo",W,true,true);g=true}}}if(typeof VMM.Slider!="undefined"){VMM.Slider.Slide=function(o,k){var a,e,b,f,q,n,p=o,A={},q="",t="",s=false,u=false,r=false,h=true,l=false,j="slide_",g=0,B={pushque:"",render:"",relayout:"",remove:"",skinny:false},C={pushque:500,render:100,relayout:100,remove:30000};j=j+p.uniqueid;this.enqueue=h;this.id=j;q=VMM.appendAndGetElement(k,"<div>","slider-item");if(typeof p.classname!="undefined"){trace("HAS CLASSNAME");VMM.Lib.addClass(q,p.classname)}else{trace("NO CLASSNAME");trace(p)}n={slide:"",text:"",media:"",media_element:"",layout:"content-container layout",has:{headline:false,text:false,media:false}};this.show=function(c){h=false;B.skinny=c;l=false;clearTimeout(B.remove);if(!s){if(u){clearTimeout(B.relayout);B.relayout=setTimeout(w,C.relayout)}else{z(c)}}};this.hide=function(){if(s&&!l){l=true;clearTimeout(B.remove);B.remove=setTimeout(y,C.remove)}};this.clearTimers=function(){clearTimeout(B.relayout);clearTimeout(B.pushque);clearTimeout(B.render)};this.layout=function(c){if(s&&u){v(c)}};this.elem=function(){return q};this.position=function(){return VMM.Lib.position(q)};this.leftpos=function(c){if(typeof c!="undefined"){VMM.Lib.css(q,"left",c)}else{return VMM.Lib.position(q).left}};this.animate=function(c,D,E){VMM.Lib.animate(q,c,D,E)};this.css=function(c,d){VMM.Lib.css(q,c,d)};this.opacity=function(c){VMM.Lib.css(q,"opacity",c)};this.width=function(){return VMM.Lib.width(q)};this.height=function(){return VMM.Lib.height(q)};this.content_height=function(){var c=VMM.Lib.find(q,".content")[0];if(c!="undefined"&&c!=null){return VMM.Lib.height(c)}else{return 0}};var z=function(c){trace("RENDER "+j);s=true;u=true;B.skinny=c;m();clearTimeout(B.pushque);clearTimeout(B.render);B.pushque=setTimeout(VMM.ExternalAPI.pushQues,C.pushque)};var y=function(){trace("REMOVE SLIDE TIMER FINISHED");s=false;VMM.Lib.detach(e);VMM.Lib.detach(a)};var w=function(){s=true;v(B.skinny,true)};var v=function(d,c){if(n.has.text){if(d){if(!r||c){VMM.Lib.removeClass(b,"pad-left");VMM.Lib.detach(e);VMM.Lib.detach(a);VMM.Lib.append(b,e);VMM.Lib.append(b,a);r=true}}else{if(r||c){VMM.Lib.addClass(b,"pad-left");VMM.Lib.detach(e);VMM.Lib.detach(a);VMM.Lib.append(b,a);VMM.Lib.append(b,e);r=false}}}else{if(c){if(n.has.headline){VMM.Lib.detach(e);VMM.Lib.append(b,e)}VMM.Lib.detach(a);VMM.Lib.append(b,a)}}};var m=function(){trace("BUILDSLIDE");f=VMM.appendAndGetElement(q,"<div>","content");b=VMM.appendAndGetElement(f,"<div>");if(p.startdate!=null&&p.startdate!=""){if(type.of(p.startdate)=="date"){if(p.type!="start"){var d=VMM.Date.prettyDate(p.startdate,false,p.precisiondate);var c=VMM.Date.prettyDate(p.enddate,false,p.precisiondate);var D="";if(p.tag!=null&&p.tag!=""){D=VMM.createElement("span",p.tag,"slide-tag")}if(d!=c){n.text+=VMM.createElement("h2",d+" &mdash; "+c+D,"date")}else{n.text+=VMM.createElement("h2",d+D,"date")}}}}if(p.headline!=null&&p.headline!=""){n.has.headline=true;if(p.type=="start"){n.text+=VMM.createElement("h2",VMM.Util.linkify_with_twitter(p.headline,"_blank"),"start")}else{n.text+=VMM.createElement("h3",VMM.Util.linkify_with_twitter(p.headline,"_blank"))}}if(p.text!=null&&p.text!=""){n.has.text=true;n.text+=VMM.createElement("p",VMM.Util.linkify_with_twitter(p.text,"_blank"))}if(n.has.text||n.has.headline){n.text=VMM.createElement("div",n.text,"container");e=VMM.appendAndGetElement(b,"<div>","text",VMM.TextElement.create(n.text))}if(p.needs_slug){}if(p.asset!=null&&p.asset!=""){if(p.asset.media!=null&&p.asset.media!=""){n.has.media=true;a=VMM.appendAndGetElement(b,"<div>","media",VMM.MediaElement.create(p.asset,p.uniqueid))}}if(n.has.text){n.layout+="-text"}if(n.has.media){n.layout+="-media"}if(n.has.text){if(B.skinny){VMM.Lib.addClass(b,n.layout);r=true}else{VMM.Lib.addClass(b,n.layout);VMM.Lib.addClass(b,"pad-left");VMM.Lib.detach(e);VMM.Lib.append(b,e)}}else{VMM.Lib.addClass(b,n.layout)}}}}var Aes={};Aes.cipher=function(b,h){var c=4;var d=h.length/c-1;var g=[[],[],[],[]];for(var a=0;a<4*c;a++){g[a%4][Math.floor(a/4)]=b[a]}g=Aes.addRoundKey(g,h,0,c);for(var f=1;f<d;f++){g=Aes.subBytes(g,c);g=Aes.shiftRows(g,c);g=Aes.mixColumns(g,c);g=Aes.addRoundKey(g,h,f,c)}g=Aes.subBytes(g,c);g=Aes.shiftRows(g,c);g=Aes.addRoundKey(g,h,d,c);var e=new Array(4*c);for(var a=0;a<4*c;a++){e[a]=g[a%4][Math.floor(a/4)]}return e};Aes.keyExpansion=function(b){var c=4;var d=b.length/4;var e=d+6;var j=new Array(c*(e+1));var h=new Array(4);for(var a=0;a<d;a++){var f=[b[4*a],b[4*a+1],b[4*a+2],b[4*a+3]];j[a]=f}for(var a=d;a<(c*(e+1));a++){j[a]=new Array(4);for(var g=0;g<4;g++){h[g]=j[a-1][g]}if(a%d==0){h=Aes.subWord(Aes.rotWord(h));for(var g=0;g<4;g++){h[g]^=Aes.rCon[a/d][g]}}else{if(d>6&&a%d==4){h=Aes.subWord(h)}}for(var g=0;g<4;g++){j[a][g]=j[a-d][g]^h[g]}}return j};Aes.subBytes=function(e,b){for(var d=0;d<4;d++){for(var a=0;a<b;a++){e[d][a]=Aes.sBox[e[d][a]]}}return e};Aes.shiftRows=function(e,b){var f=new Array(4);for(var d=1;d<4;d++){for(var a=0;a<4;a++){f[a]=e[d][(a+d)%b]}for(var a=0;a<4;a++){e[d][a]=f[a]}}return e};Aes.mixColumns=function(j,h){for(var f=0;f<4;f++){var d=new Array(4);var e=new Array(4);for(var g=0;g<4;g++){d[g]=j[g][f];e[g]=j[g][f]&128?j[g][f]<<1^283:j[g][f]<<1}j[0][f]=e[0]^d[1]^e[1]^d[2]^d[3];j[1][f]=d[0]^e[1]^d[2]^e[2]^d[3];j[2][f]=d[0]^d[1]^e[2]^d[3]^e[3];j[3][f]=d[0]^e[0]^d[1]^d[2]^e[3]}return j};Aes.addRoundKey=function(f,g,e,b){for(var d=0;d<4;d++){for(var a=0;a<b;a++){f[d][a]^=g[e*4+a][d]}}return f};Aes.subWord=function(b){for(var a=0;a<4;a++){b[a]=Aes.sBox[b[a]]}return b};Aes.rotWord=function(c){var b=c[0];for(var a=0;a<3;a++){c[a]=c[a+1]}c[3]=b;return c};Aes.sBox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];Aes.rCon=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];Aes.Ctr={};Aes.Ctr.encrypt=function(z,y,r){var f=16;if(!(r==128||r==192||r==256)){return""}z=Utf8.encode(z);y=Utf8.encode(y);var s=r/8;var A=new Array(s);for(var o=0;o<s;o++){A[o]=isNaN(y.charCodeAt(o))?0:y.charCodeAt(o)}var p=Aes.cipher(A,Aes.keyExpansion(A));p=p.concat(p.slice(0,s-16));var m=new Array(f);var t=(new Date()).getTime();var u=t%1000;var w=Math.floor(t/1000);var v=Math.floor(Math.random()*65535);for(var o=0;o<2;o++){m[o]=(u>>>o*8)&255}for(var o=0;o<2;o++){m[o+2]=(v>>>o*8)&255}for(var o=0;o<4;o++){m[o+4]=(w>>>o*8)&255}var n="";for(var o=0;o<8;o++){n+=String.fromCharCode(m[o])}var q=Aes.keyExpansion(p);var d=Math.ceil(z.length/f);var l=new Array(d);for(var a=0;a<d;a++){for(var g=0;g<4;g++){m[15-g]=(a>>>g*8)&255}for(var g=0;g<4;g++){m[15-g-4]=(a/4294967296>>>g*8)}var j=Aes.cipher(m,q);var e=a<d-1?f:(z.length-1)%f+1;var h=new Array(e);for(var o=0;o<e;o++){h[o]=j[o]^z.charCodeAt(a*f+o);h[o]=String.fromCharCode(h[o])}l[a]=h.join("")}var k=n+l.join("");k=Base64.encode(k);return k};Aes.Ctr.decrypt=function(g,q,n){var d=16;if(!(n==128||n==192||n==256)){return""}g=Base64.decode(g);q=Utf8.encode(q);var p=n/8;var u=new Array(p);for(var k=0;k<p;k++){u[k]=isNaN(q.charCodeAt(k))?0:q.charCodeAt(k)}var l=Aes.cipher(u,Aes.keyExpansion(u));l=l.concat(l.slice(0,p-16));var h=new Array(8);ctrTxt=g.slice(0,8);for(var k=0;k<8;k++){h[k]=ctrTxt.charCodeAt(k)}var m=Aes.keyExpansion(l);var o=Math.ceil((g.length-8)/d);var j=new Array(o);for(var a=0;a<o;a++){j[a]=g.slice(8+a*d,8+a*d+d)}g=j;var s=new Array(g.length);for(var a=0;a<o;a++){for(var e=0;e<4;e++){h[15-e]=((a)>>>e*8)&255}for(var e=0;e<4;e++){h[15-e-4]=(((a+1)/4294967296-1)>>>e*8)&255}var f=Aes.cipher(h,m);var t=new Array(g[a].length);for(var k=0;k<g[a].length;k++){t[k]=f[k]^g[a].charCodeAt(k);t[k]=String.fromCharCode(t[k])}s[a]=t.join("")}var r=s.join("");r=Utf8.decode(r);return r};var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Base64.encode=function(r,s){s=(typeof s=="undefined")?false:s;var m,n,o,b,h,j,k,l,g=[],p="",d,q,f;var a=Base64.code;q=s?r.encodeUTF8():r;d=q.length%3;if(d>0){while(d++<3){p+="=";q+="\0"}}for(d=0;d<q.length;d+=3){m=q.charCodeAt(d);n=q.charCodeAt(d+1);o=q.charCodeAt(d+2);b=m<<16|n<<8|o;h=b>>18&63;j=b>>12&63;k=b>>6&63;l=b&63;g[d/3]=a.charAt(h)+a.charAt(j)+a.charAt(k)+a.charAt(l)}f=g.join("");f=f.slice(0,f.length-p.length)+p;return f};Base64.decode=function(q,r){r=(typeof r=="undefined")?false:r;var m,n,o,h,j,k,l,b,g=[],p,f;var a=Base64.code;f=r?q.decodeUTF8():q;for(var e=0;e<f.length;e+=4){h=a.indexOf(f.charAt(e));j=a.indexOf(f.charAt(e+1));k=a.indexOf(f.charAt(e+2));l=a.indexOf(f.charAt(e+3));b=h<<18|j<<12|k<<6|l;m=b>>>16&255;n=b>>>8&255;o=b&255;g[e/4]=String.fromCharCode(m,n,o);if(l==64){g[e/4]=String.fromCharCode(m,n)}if(k==64){g[e/4]=String.fromCharCode(m)}}p=g.join("");return r?p.decodeUTF8():p};var Utf8={};Utf8.encode=function(a){var b=a.replace(/[\u0080-\u07ff]/g,function(d){var e=d.charCodeAt(0);return String.fromCharCode(192|e>>6,128|e&63)});b=b.replace(/[\u0800-\uffff]/g,function(d){var e=d.charCodeAt(0);return String.fromCharCode(224|e>>12,128|e>>6&63,128|e&63)});return b};Utf8.decode=function(b){var a=b.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(d){var e=((d.charCodeAt(0)&15)<<12)|((d.charCodeAt(1)&63)<<6)|(d.charCodeAt(2)&63);return String.fromCharCode(e)});a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(d){var e=(d.charCodeAt(0)&31)<<6|d.charCodeAt(1)&63;return String.fromCharCode(e)});return a};!function(a){var b=function(c,d){this.init("tooltip",c,d)};b.prototype={constructor:b,init:function(g,c,f){var d,e;this.type=g;this.$element=a(c);this.options=this.getOptions(f);this.enabled=true;if(this.options.trigger!="manual"){d=this.options.trigger=="hover"?"mouseenter":"focus";e=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(d,this.options.selector,a.proxy(this.enter,this));this.$element.on(e,this.options.selector,a.proxy(this.leave,this))}this.options.selector?(this._options=a.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=a.extend({},a.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(c){var d=a(c.currentTarget)[this.type](this._options).data(this.type);if(!d.options.delay||!d.options.delay.show){d.show()}else{d.hoverState="in";setTimeout(function(){if(d.hoverState=="in"){d.show()}},d.options.delay.show)}},leave:function(c){var d=a(c.currentTarget)[this.type](this._options).data(this.type);if(!d.options.delay||!d.options.delay.hide){d.hide()}else{d.hoverState="out";setTimeout(function(){if(d.hoverState=="out"){d.hide()}},d.options.delay.hide)}},show:function(){var c,f,h,e,d,g,j;if(this.hasContent()&&this.enabled){c=this.tip();this.setContent();if(this.options.animation){c.addClass("fade")}g=typeof this.options.placement=="function"?this.options.placement.call(this,c[0],this.$element[0]):this.options.placement;f=/in/.test(g);c.remove().css({top:0,left:0,display:"block"}).appendTo(f?this.$element:document.body);h=this.getPosition(f);e=c[0].offsetWidth;d=c[0].offsetHeight;switch(f?g.split(" ")[1]:g){case"bottom":j={top:h.top+h.height,left:h.left+h.width/2-e/2};break;case"top":j={top:h.top-d,left:h.left+h.width/2-e/2};break;case"left":j={top:h.top+h.height/2-d/2,left:h.left-e};break;case"right":j={top:h.top+h.height/2-d/2,left:h.left+h.width};break}c.css(j).addClass(g).addClass("in")}},setContent:function(){var c=this.tip();c.find(".tooltip-inner").html(this.getTitle());c.removeClass("fade in top bottom left right")},hide:function(){var e=this,c=this.tip();c.removeClass("in");function d(){var f=setTimeout(function(){c.off(a.support.transition.end).remove()},500);c.one(a.support.transition.end,function(){clearTimeout(f);c.remove()})}a.support.transition&&this.$tip.hasClass("fade")?d():c.remove()},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return a.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,c=this.$element,d=this.options;e=c.attr("data-original-title")||(typeof d.title=="function"?d.title.call(c[0]):d.title);e=e.toString().replace(/(^\s*|\s*$)/,"");return e},tip:function(){return this.$tip=this.$tip||a(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("tooltip"),f=typeof c=="object"&&c;if(!e){d.data("tooltip",(e=new b(this,f)))}if(typeof c=="string"){e[c]()}})};a.fn.tooltip.Constructor=b;a.fn.tooltip.defaults={animation:true,delay:0,selector:false,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery);if(typeof VMM!="undefined"&&typeof VMM.StoryJS=="undefined"){VMM.StoryJS=function(){this.init=function(a){}}}if(typeof VMM!="undefined"&&typeof VMM.Timeline=="undefined"){VMM.Timeline=function(j,X,v){var f,a,b,c,e,d,S,U,W="2.x",T="#timelinejs",r={},p={},g=[],m={},z=false,y=false,C=false,E=false;if(type.of(j)=="string"){if(j.match("#")){T=j}else{T="#"+j}}else{T="#timelinejs"}m={embed:false,events:{data_ready:"DATAREADY",messege:"MESSEGE",headline:"HEADLINE",slide_change:"SLIDE_CHANGE",resize:"resize"},id:T,source:"nothing",type:"timeline",touch:false,orientation:"normal",maptype:"toner",version:"2.x",preload:4,current_slide:0,hash_bookmark:false,start_at_end:false,start_at_slide:0,start_zoom_adjust:0,start_page:false,api_keys:{google:"",flickr:"",twitter:""},interval:10,something:0,width:960,height:540,spacing:15,loaded:{slider:false,timenav:false,percentloaded:0},nav:{start_page:false,interval_width:200,density:4,minor_width:0,minor_left:0,constraint:{left:0,right:0,right_min:0,right_max:0},zoom:{adjust:0},multiplier:{current:6,min:0.1,max:50},rows:[1,1,1],width:960,height:200,marker:{width:150,height:50}},feature:{width:960,height:540},slider:{width:720,height:400,content:{width:720,height:400,padding:130,padding_default:130},nav:{width:100,height:200}},ease:"easeInOutExpo",duration:1000,gmap_key:"",language:VMM.Language};if(X!=null&&X!=""){m.width=X;z=true}if(v!=null&&v!=""){m.height=v;y=true}if(window.location.hash){var A=window.location.hash.substring(1);if(!isNaN(A)){m.current_slide=parseInt(A)}}window.onhashchange=function(){var h=window.location.hash.substring(1);if(m.hash_bookmark){if(E){u(parseInt(h))}else{E=false}}else{u(parseInt(h))}};function n(h){if(typeof embed_config=="object"){timeline_config=embed_config}if(typeof timeline_config=="object"){trace("HAS TIMELINE CONFIG");m=VMM.Util.mergeConfig(m,timeline_config)}else{if(typeof h=="object"){m=VMM.Util.mergeConfig(m,h)}}if(VMM.Browser.device=="mobile"||VMM.Browser.device=="tablet"){m.touch=true}m.nav.width=m.width;m.nav.height=200;m.feature.width=m.width;m.feature.height=m.height-m.nav.height;m.nav.zoom.adjust=parseInt(m.start_zoom_adjust,10);VMM.Timeline.Config=m;VMM.master_config.Timeline=VMM.Timeline.Config;this.events=m.events;if(m.gmap_key!=""){m.api_keys.google=m.gmap_key}trace("VERSION "+m.version);W=m.version}function o(){f=VMM.getElement(T);VMM.Lib.addClass(f,"vco-timeline");VMM.Lib.addClass(f,"vco-storyjs");a=VMM.appendAndGetElement(f,"<div>","vco-container vco-main");b=VMM.appendAndGetElement(a,"<div>","vco-feature");e=VMM.appendAndGetElement(b,"<div>","vco-slider");d=VMM.appendAndGetElement(a,"<div>","vco-navigation");c=VMM.appendAndGetElement(f,"<div>","vco-feedback","");if(typeof m.language.right_to_left!="undefined"){VMM.Lib.addClass(f,"vco-right-to-left")}S=new VMM.Slider(e,m);U=new VMM.Timeline.TimeNav(d);if(!z){m.width=VMM.Lib.width(f)}else{VMM.Lib.width(f,m.width)}if(!y){m.height=VMM.Lib.height(f)}else{VMM.Lib.height(f,m.height)}if(m.touch){VMM.Lib.addClass(f,"vco-touch")}else{VMM.Lib.addClass(f,"vco-notouch")}}function G(w,h){trace("onDataReady");p=h.timeline;if(type.of(p.era)!="array"){p.era=[]}l()}function H(){k()}function N(){V();S.setSize(m.feature.width,m.feature.height);U.setSize(m.width,m.height);if(M()){Q()}}function J(h){m.loaded.slider=true;F()}function F(h){m.loaded.percentloaded=m.loaded.percentloaded+25;if(m.loaded.slider&&m.loaded.timenav){B()}}function L(h){m.loaded.timenav=true;F()}function K(h){E=true;m.current_slide=S.getCurrentNumber();P(m.current_slide);U.setMarker(m.current_slide,m.ease,m.duration)}function I(h){E=true;m.current_slide=U.getCurrentNumber();P(m.current_slide);S.setSlide(m.current_slide)}function u(h){if(h<=g.length-1&&h>=0){m.current_slide=h;S.setSlide(m.current_slide);U.setMarker(m.current_slide,m.ease,m.duration)}}function P(h){if(m.hash_bookmark){window.location.hash="#"+h.toString()}}function t(){}function Q(){var h="",w=O(window.orientation);if(VMM.Browser.device=="mobile"){if(w=="portrait"){h="width=device-width; initial-scale=0.5, maximum-scale=0.5"}else{if(w=="landscape"){h="width=device-width; initial-scale=0.5, maximum-scale=0.5"}else{h="width=device-width, initial-scale=1, maximum-scale=1.0"}}}else{if(VMM.Browser.device=="tablet"){}}if(document.getElementById("viewport")){}else{}}function O(w){var h="";if(w==0||w==180){h="portrait"}else{if(w==90||w==-90){h="landscape"}else{h="normal"}}return h}function M(){var h=O(window.orientation);if(h==m.orientation){return false}else{m.orientation=h;return true}}this.init=function(w,h){trace("INIT");Q();n(w);o();if(type.of(h)=="string"){m.source=h}VMM.Date.setLanguage(m.language);VMM.master_config.language=m.language;VMM.ExternalAPI.setKeys(m.api_keys);VMM.ExternalAPI.googlemaps.setMapType(m.maptype);VMM.bindEvent(global,G,m.events.data_ready);VMM.bindEvent(global,R,m.events.messege);VMM.fireEvent(global,m.events.messege,m.language.messages.loading_timeline);if(VMM.Browser.browser=="Explorer"||VMM.Browser.browser=="MSIE"){if(parseInt(VMM.Browser.version,10)<=7){C=true}}if(type.of(m.source)=="string"||type.of(m.source)=="object"){VMM.Timeline.DataObj.getData(m.source)}else{VMM.fireEvent(global,m.events.messege,"No data source provided")}};this.iframeLoaded=function(){trace("iframeLoaded")};this.reload=function(h){trace("Load new timeline data"+h);VMM.fireEvent(global,m.events.messege,m.language.messages.loading_timeline);p={};VMM.Timeline.DataObj.getData(h);m.current_slide=0;S.setSlide(0);U.setMarker(0,m.ease,m.duration)};function s(h){VMM.getJSON(h,function(w){p=VMM.Timeline.DataObj.getData(w);VMM.fireEvent(global,m.events.data_ready)})}function R(h,w,Y){trace("showMessege "+w);if(Y){VMM.attachElement(c,w)}else{VMM.attachElement(c,VMM.MediaElement.loadingmessage(w))}}function B(){VMM.Lib.animate(c,m.duration,m.ease*4,{opacity:0},q)}function q(){VMM.Lib.detach(c)}function k(){if(parseInt(m.start_at_slide)>0&&m.current_slide==0){m.current_slide=parseInt(m.start_at_slide)}if(m.start_at_end&&m.current_slide==0){m.current_slide=g.length-1}if(C){C=true;VMM.fireEvent(global,m.events.messege,"Internet Explorer "+VMM.Browser.version+" is not supported by TimelineJS. Please update your browser to version 8 or higher.")}else{q();N();VMM.bindEvent(e,J,"LOADED");VMM.bindEvent(d,L,"LOADED");VMM.bindEvent(e,K,"UPDATE");VMM.bindEvent(d,I,"UPDATE");S.init(g);U.init(g,p.era);VMM.bindEvent(global,N,m.events.resize)}}function D(){trace("IE7 or lower");for(var h=0;h<g.length;h++){trace(g[h])}}function V(){trace("UPDATE SIZE");m.width=VMM.Lib.width(f);m.height=VMM.Lib.height(f);m.nav.width=m.width;m.feature.width=m.width;m.feature.height=m.height-m.nav.height-3;if(VMM.Browser.device=="mobile"){}if(m.width<641){VMM.Lib.addClass(f,"vco-skinny")}else{VMM.Lib.removeClass(f,"vco-skinny")}}function l(){g=[];VMM.fireEvent(global,m.events.messege,"Building Dates");V();for(var Z=0;Z<p.date.length;Z++){if(p.date[Z].startDate!=null&&p.date[Z].startDate!=""){var h={},Y=VMM.Date.parse(p.date[Z].startDate,true),w;h.startdate=Y.date;h.precisiondate=Y.precision;if(!isNaN(h.startdate)){if(p.date[Z].endDate!=null&&p.date[Z].endDate!=""){h.enddate=VMM.Date.parse(p.date[Z].endDate)}else{h.enddate=h.startdate}h.needs_slug=false;if(p.date[Z].headline==""){if(p.date[Z].slug!=null&&p.date[Z].slug!=""){h.needs_slug=true}}h.title=p.date[Z].headline;h.headline=p.date[Z].headline;h.type=p.date[Z].type;h.date=VMM.Date.prettyDate(h.startdate,false,h.precisiondate);h.asset=p.date[Z].asset;h.fulldate=h.startdate.getTime();h.text=p.date[Z].text;h.content="";h.tag=p.date[Z].tag;h.slug=p.date[Z].slug;h.uniqueid=VMM.Util.unique_ID(7);h.classname=p.date[Z].classname;g.push(h)}}}if(p.type!="storify"){g.sort(function(ad,ae){return ad.fulldate-ae.fulldate})}if(p.headline!=null&&p.headline!=""&&p.text!=null&&p.text!=""){var aa,Y,h={},ac=0,ab;if(typeof p.startDate!="undefined"){Y=VMM.Date.parse(p.startDate,true);aa=Y.date}else{aa=false}trace("HAS STARTPAGE");trace(aa);if(aa&&aa<g[0].startdate){h.startdate=new Date(aa)}else{ab=g[0].startdate;h.startdate=new Date(g[0].startdate);if(ab.getMonth()===0&&ab.getDate()==1&&ab.getHours()===0&&ab.getMinutes()===0){h.startdate.setFullYear(ab.getFullYear()-1)}else{if(ab.getDate()<=1&&ab.getHours()===0&&ab.getMinutes()===0){h.startdate.setMonth(ab.getMonth()-1)}else{if(ab.getHours()===0&&ab.getMinutes()===0){h.startdate.setDate(ab.getDate()-1)}else{if(ab.getMinutes()===0){h.startdate.setHours(ab.getHours()-1)}else{h.startdate.setMinutes(ab.getMinutes()-1)}}}}}h.uniqueid=VMM.Util.unique_ID(7);h.enddate=h.startdate;h.precisiondate=Y.precision;h.title=p.headline;h.headline=p.headline;h.text=p.text;h.type="start";h.date=VMM.Date.prettyDate(p.startDate,false,h.precisiondate);h.asset=p.asset;h.slug=false;h.needs_slug=false;h.fulldate=h.startdate.getTime();if(m.embed){VMM.fireEvent(global,m.events.headline,h.headline)}g.unshift(h)}if(p.type!="storify"){g.sort(function(ad,ae){return ad.fulldate-ae.fulldate})}H()}};VMM.Timeline.Config={}}if(typeof VMM.Timeline!="undefined"&&typeof VMM.Timeline.TimeNav=="undefined"){VMM.Timeline.TimeNav=function(ad,D,C){trace("VMM.Timeline.TimeNav");var k,a,c,h,e,g,d,f,m,l,j,n,o,p,b,A=VMM.Timeline.Config,al,K={},aq={},T=ad,G=[],I=[],U=[],O=[],S=[],am=[],F=0,q=false,J,B,ap={interval_position:""},ao={left:"",visible:{left:"",right:""}},an={day:24,month:12,year:10,hour:60,minute:60,second:1000,decade:10,century:100,millenium:1000,age:1000000,epoch:10000000,era:100000000,eon:500000000,week:4.34812141,days_in_month:30.4368499,days_in_week:7,weeks_in_month:4.34812141,weeks_in_year:52.177457,days_in_year:365.242199,hours_in_day:24},H={day:86400000,week:7,month:30.4166666667,year:12,hour:24,minute:1440,second:86400,decade:10,century:100,millenium:1000,age:1000000,epoch:10000000,era:100000000,eon:500000000},N={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"_idd",interval_type:"interval"},R={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"major",interval_type:"interval major"},Q={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"_dd_minor",interval_type:"interval minor"},P={day:{},month:{},year:{},hour:{},minute:{},second:{},decade:{},century:{},millenium:{},week:{},age:{},epoch:{},era:{},eon:{}};al=A.nav.marker.height/2;A.nav.rows={full:[1,al*2,al*4],half:[1,al,al*2,al*3,al*4,al*5],current:[]};if(D!=null&&D!=""){A.nav.width=D}if(C!=null&&C!=""){A.nav.height=C}this.init=function(at,au){trace("VMM.Timeline.TimeNav init");if(typeof at!="undefined"){this.setData(at,au)}else{trace("WAITING ON DATA")}};this.setData=function(at,au){if(typeof at!="undefined"){G={};G=at;J=au;t()}else{trace("NO DATA")}};this.setSize=function(au,at){if(au!=null){A.width=au}if(at!=null){A.height=at}if(q){ak()}};this.setMarker=function(aw,au,at,av){M(aw,au,at)};this.getCurrentNumber=function(){return F};function W(){trace("onConfigSet")}function ak(at){A.nav.constraint.left=(A.width/2);A.nav.constraint.right=A.nav.constraint.right_min-(A.width/2);b.updateConstraint(A.nav.constraint);VMM.Lib.css(m,"left",Math.round(A.width/2)+2);VMM.Lib.css(l,"left",Math.round(A.width/2)-8);M(A.current_slide,A.ease,A.duration,true,at)}function ar(){VMM.fireEvent(T,"UPDATE")}function ab(){b.cancelSlide();if(A.nav.multiplier.current>A.nav.multiplier.min){if(A.nav.multiplier.current<=1){A.nav.multiplier.current=A.nav.multiplier.current-0.25}else{if(A.nav.multiplier.current>5){if(A.nav.multiplier.current>16){A.nav.multiplier.current=Math.round(A.nav.multiplier.current-10)}else{A.nav.multiplier.current=Math.round(A.nav.multiplier.current-4)}}else{A.nav.multiplier.current=Math.round(A.nav.multiplier.current-1)}}if(A.nav.multiplier.current<=0){A.nav.multiplier.current=A.nav.multiplier.min}aj()}}function ac(){b.cancelSlide();if(A.nav.multiplier.current<A.nav.multiplier.max){if(A.nav.multiplier.current>4){if(A.nav.multiplier.current>16){A.nav.multiplier.current=Math.round(A.nav.multiplier.current+10)}else{A.nav.multiplier.current=Math.round(A.nav.multiplier.current+4)}}else{A.nav.multiplier.current=Math.round(A.nav.multiplier.current+1)}if(A.nav.multiplier.current>=A.nav.multiplier.max){A.nav.multiplier.current=A.nav.multiplier.max}aj()}}function V(at){b.cancelSlide();M(0);ar()}function Z(au){var at=0,av=0;if(!au){au=window.event}if(au.originalEvent){au=au.originalEvent}if(au.wheelDelta){at=au.wheelDelta/6}else{if(au.detail){at=-au.detail*12}}if(at){if(au.preventDefault){au.preventDefault()}au.returnValue=false}if(typeof au.wheelDeltaX!="undefined"){at=au.wheelDeltaY/6;if(Math.abs(au.wheelDeltaX)>Math.abs(au.wheelDeltaY)){at=au.wheelDeltaX/6}else{at=au.wheelDeltaY/6}}av=VMM.Lib.position(k).left+at;if(av>A.nav.constraint.left){av=A.width/2}else{if(av<A.nav.constraint.right){av=A.nav.constraint.right}}VMM.Lib.css(k,"left",av)}function aj(){trace("config.nav.multiplier "+A.nav.multiplier.current);ag(true);ae(true);af(e,O,true,true);af(g,S,true);A.nav.constraint.left=(A.width/2);A.nav.constraint.right=A.nav.constraint.right_min-(A.width/2);b.updateConstraint(A.nav.constraint)}function X(at){b.cancelSlide();M(at.data.number);ar()}function Y(at){VMM.Lib.toggleClass(at.data.elem,"zFront")}function M(aC,aw,av,ax,ay){trace("GO TO MARKER");var au=A.ease,at=A.duration,aB=false,aA=false;F=aC;ao.left=(A.width/2)-U[F].pos_left;ao.visible.left=Math.abs(ao.left)-100;ao.visible.right=Math.abs(ao.left)+A.width+100;if(F==0){aA=true}if(F+1==U.length){aB=true}if(aw!=null&&aw!=""){au=aw}if(av!=null&&av!=""){at=av}for(var az=0;az<U.length;az++){VMM.Lib.removeClass(U[az].marker,"active")}if(A.start_page&&U[0].type=="start"){VMM.Lib.visible(U[0].marker,false);VMM.Lib.addClass(U[0].marker,"start")}VMM.Lib.addClass(U[F].marker,"active");VMM.Lib.stop(k);VMM.Lib.animate(k,at,au,{left:ao.left})}function aa(au,at){VMM.Lib.animate(k,at.time/2,A.ease,{left:at.left})}function s(){var av=0,ax=0,ay=0,aw=[],au=0;for(au=0;au<U.length;au++){if(G[au].type=="start"){}else{var at=ah(N,U[au].relative_pos),av=ax;ax=at.begin;ay=ax-av;aw.push(ay)}}return VMM.Util.average(aw).mean}function r(){var az=0,aw=0,at="",au=0,av=[],ay=true,ax=0;for(ax=0;ax<G.length;ax++){if(G[ax].type=="start"){trace("DATA DATE IS START")}else{at=G[ax].startdate;az=aw;aw=at;au=aw-az;av.push(au)}}return VMM.Util.average(av)}function z(){var au=A.nav.multiplier.current,at=0;for(at=0;at<au;at++){if(s()<75){if(A.nav.multiplier.current>1){A.nav.multiplier.current=(A.nav.multiplier.current-1)}}}}function y(){var at=L(G[0].startdate),au=L(G[G.length-1].enddate);P.eon.type="eon";P.eon.first=at.eons;P.eon.base=Math.floor(at.eons);P.eon.last=au.eons;P.eon.number=aq.eons;P.eon.multiplier=an.eons;P.eon.minor=an.eons;P.era.type="era";P.era.first=at.eras;P.era.base=Math.floor(at.eras);P.era.last=au.eras;P.era.number=aq.eras;P.era.multiplier=an.eras;P.era.minor=an.eras;P.epoch.type="epoch";P.epoch.first=at.epochs;P.epoch.base=Math.floor(at.epochs);P.epoch.last=au.epochs;P.epoch.number=aq.epochs;P.epoch.multiplier=an.epochs;P.epoch.minor=an.epochs;P.age.type="age";P.age.first=at.ages;P.age.base=Math.floor(at.ages);P.age.last=au.ages;P.age.number=aq.ages;P.age.multiplier=an.ages;P.age.minor=an.ages;P.millenium.type="millenium";P.millenium.first=at.milleniums;P.millenium.base=Math.floor(at.milleniums);P.millenium.last=au.milleniums;P.millenium.number=aq.milleniums;P.millenium.multiplier=an.millenium;P.millenium.minor=an.millenium;P.century.type="century";P.century.first=at.centuries;P.century.base=Math.floor(at.centuries);P.century.last=au.centuries;P.century.number=aq.centuries;P.century.multiplier=an.century;P.century.minor=an.century;P.decade.type="decade";P.decade.first=at.decades;P.decade.base=Math.floor(at.decades);P.decade.last=au.decades;P.decade.number=aq.decades;P.decade.multiplier=an.decade;P.decade.minor=an.decade;P.year.type="year";P.year.first=at.years;P.year.base=Math.floor(at.years);P.year.last=au.years;P.year.number=aq.years;P.year.multiplier=1;P.year.minor=an.month;P.month.type="month";P.month.first=at.months;P.month.base=Math.floor(at.months);P.month.last=au.months;P.month.number=aq.months;P.month.multiplier=1;P.month.minor=Math.round(an.week);P.week.type="week";P.week.first=at.weeks;P.week.base=Math.floor(at.weeks);P.week.last=au.weeks;P.week.number=aq.weeks;P.week.multiplier=1;P.week.minor=7;P.day.type="day";P.day.first=at.days;P.day.base=Math.floor(at.days);P.day.last=au.days;P.day.number=aq.days;P.day.multiplier=1;P.day.minor=24;P.hour.type="hour";P.hour.first=at.hours;P.hour.base=Math.floor(at.hours);P.hour.last=au.hours;P.hour.number=aq.hours;P.hour.multiplier=1;P.hour.minor=60;P.minute.type="minute";P.minute.first=at.minutes;P.minute.base=Math.floor(at.minutes);P.minute.last=au.minutes;P.minute.number=aq.minutes;P.minute.multiplier=1;P.minute.minor=60;P.second.type="decade";P.second.first=at.seconds;P.second.base=Math.floor(at.seconds);P.second.last=au.seconds;P.second.number=aq.seconds;P.second.multiplier=1;P.second.minor=10}function L(av,au){var at={};at.days=av/H.day;at.weeks=at.days/H.week;at.months=at.days/H.month;at.years=at.months/H.year;at.hours=at.days*H.hour;at.minutes=at.days*H.minute;at.seconds=at.days*H.second;at.decades=at.years/H.decade;at.centuries=at.years/H.century;at.milleniums=at.years/H.millenium;at.ages=at.years/H.age;at.epochs=at.years/H.epoch;at.eras=at.years/H.era;at.eons=at.years/H.eon;return at}function ai(au,ax,ay){var at,av,aw=au.type,az={start:"",end:"",type:aw};at=L(ax);az.start=ax.months;if(aw=="eon"){az.start=at.eons}else{if(aw=="era"){az.start=at.eras}else{if(aw=="epoch"){az.start=at.epochs}else{if(aw=="age"){az.start=at.ages}else{if(aw=="millenium"){az.start=ax.milleniums}else{if(aw=="century"){az.start=at.centuries}else{if(aw=="decade"){az.start=at.decades}else{if(aw=="year"){az.start=at.years}else{if(aw=="month"){az.start=at.months}else{if(aw=="week"){az.start=at.weeks}else{if(aw=="day"){az.start=at.days}else{if(aw=="hour"){az.start=at.hours}else{if(aw=="minute"){az.start=at.minutes}}}}}}}}}}}}}if(type.of(ay)=="date"){av=L(ay);az.end=ay.months;if(aw=="eon"){az.end=av.eons}else{if(aw=="era"){az.end=av.eras}else{if(aw=="epoch"){az.end=av.epochs}else{if(aw=="age"){az.end=av.ages}else{if(aw=="millenium"){az.end=ay.milleniums}else{if(aw=="century"){az.end=av.centuries}else{if(aw=="decade"){az.end=av.decades}else{if(aw=="year"){az.end=av.years}else{if(aw=="month"){az.end=av.months}else{if(aw=="week"){az.end=av.weeks}else{if(aw=="day"){az.end=av.days}else{if(aw=="hour"){az.end=av.hours}else{if(aw=="minute"){az.end=av.minutes}}}}}}}}}}}}}}else{az.end=az.start}return az}function ah(at,au){return{begin:(au.start-N.base)*(A.nav.interval_width/A.nav.multiplier.current),end:(au.end-N.base)*(A.nav.interval_width/A.nav.multiplier.current)}}function ag(ax){var aL=2,aK=0,aJ=-2,aM=0,aN=0,aC=150,aB=6,at=0,aw=A.width,aF=[],aH=6,av={left:ao.visible.left-aw,right:ao.visible.right+aw},au=0,az=0;A.nav.minor_width=A.width;VMM.Lib.removeClass(".flag","row1");VMM.Lib.removeClass(".flag","row2");VMM.Lib.removeClass(".flag","row3");for(au=0;au<U.length;au++){var aA,aD=U[au],aE=ah(N,U[au].relative_pos),aO=0,ay=false,aI={id:au,pos:0,row:0},aG=0;aE.begin=Math.round(aE.begin+aJ);aE.end=Math.round(aE.end+aJ);aA=Math.round(aE.end-aE.begin);aD.pos_left=aE.begin;if(F==au){ao.left=(A.width/2)-aE;ao.visible.left=Math.abs(ao.left);ao.visible.right=Math.abs(ao.left)+A.width;av.left=ao.visible.left-aw;av.right=ao.visible.right+aw}if(Math.abs(aE.begin)>=av.left&&Math.abs(aE.begin)<=av.right){ay=true}if(ax){VMM.Lib.stop(aD.marker);VMM.Lib.animate(aD.marker,A.duration/2,A.ease,{left:aE.begin})}else{VMM.Lib.stop(aD.marker);VMM.Lib.css(aD.marker,"left",aE.begin)}if(au==F){at=aE.begin}if(aA>5){VMM.Lib.css(aD.lineevent,"height",aB);VMM.Lib.css(aD.lineevent,"top",aC);if(ax){VMM.Lib.animate(aD.lineevent,A.duration/2,A.ease,{width:aA})}else{VMM.Lib.css(aD.lineevent,"width",aA)}}if(am.length>0){for(az=0;az<am.length;az++){if(az<A.nav.rows.current.length){if(aD.tag==am[az]){aL=az;if(az==A.nav.rows.current.length-1){trace("ON LAST ROW");VMM.Lib.addClass(aD.flag,"flag-small-last")}}}}aO=A.nav.rows.current[aL]}else{if(aE.begin-aK.begin<(A.nav.marker.width+A.spacing)){if(aL<A.nav.rows.current.length-1){aL++}else{aL=0;aM++}}else{aM=1;aL=1}aO=A.nav.rows.current[aL]}aK=aE;aI.pos=aE;aI.row=aL;aF.push(aI);if(aF.length>aH){aF.remove(0)}if(ax){VMM.Lib.stop(aD.flag);VMM.Lib.animate(aD.flag,A.duration,A.ease,{top:aO})}else{VMM.Lib.stop(aD.flag);VMM.Lib.css(aD.flag,"top",aO)}if(A.start_page&&U[au].type=="start"){VMM.Lib.visible(aD.marker,false)}if(aE>A.nav.minor_width){A.nav.minor_width=aE}if(aE<A.nav.minor_left){A.nav.minor_left=aE}}if(ax){VMM.Lib.stop(k);VMM.Lib.animate(k,A.duration/2,A.ease,{left:(A.width/2)-(at)})}else{}}function ae(ax){var aw=0,ay=0;for(aw=0;aw<I.length;aw++){var at=I[aw],az=ah(N,at.relative_pos),aB=0,aA=0,au=A.nav.marker.height*A.nav.rows.full.length,av=az.end-az.begin;if(at.tag!=""){au=(A.nav.marker.height*A.nav.rows.full.length)/A.nav.rows.current.length;for(ay=0;ay<am.length;ay++){if(ay<A.nav.rows.current.length){if(at.tag==am[ay]){aA=ay}}}aB=A.nav.rows.current[aA]}else{aB=-1}if(ax){VMM.Lib.stop(at.content);VMM.Lib.stop(at.text_content);VMM.Lib.animate(at.content,A.duration/2,A.ease,{top:aB,left:az.begin,width:av,height:au});VMM.Lib.animate(at.text_content,A.duration/2,A.ease,{left:az.begin})}else{VMM.Lib.stop(at.content);VMM.Lib.stop(at.text_content);VMM.Lib.css(at.content,"left",az.begin);VMM.Lib.css(at.content,"width",av);VMM.Lib.css(at.content,"height",au);VMM.Lib.css(at.content,"top",aB);VMM.Lib.css(at.text_content,"left",az.begin)}}}function af(aJ,aI,aA,aC){var aE=0,aF=0,az=A.width,ay={left:ao.visible.left-az,right:ao.visible.right+az};not_too_many=true,i=0;A.nav.minor_left=0;if(aI.length>100){not_too_many=false;trace("TOO MANY "+aI.length)}for(i=0;i<aI.length;i++){var au=aI[i].element,av=aI[i].date,aw=aI[i].visible,ax=ah(N,aI[i].relative_pos),aG=ax.begin,at=aI[i].animation,aD=true,aB=false,aH=50;at.pos=aG;at.animate=false;if(Math.abs(aG)>=ay.left&&Math.abs(aG)<=ay.right){aB=true}if(true){if(A.nav.multiplier.current>16&&aC){aD=false}else{if((aG-aE)<65){if((aG-aE)<35){if(i%4==0){if(aG==0){aD=false}}else{aD=false}}else{if(!VMM.Util.isEven(i)){aD=false}}}}if(aD){if(aI[i].is_detached){VMM.Lib.append(aJ,au);aI[i].is_detached=false}}else{aI[i].is_detached=true;VMM.Lib.detach(au)}if(aw){if(!aD){at.opacity="0";if(aA&&not_too_many){at.animate=true}aI[i].interval_visible=false}else{at.opacity="100";if(aA&&aB){at.animate=true}}}else{at.opacity="100";if(aD){if(aA&&not_too_many){at.animate=true}else{if(aA&&aB){at.animate=true}}aI[i].interval_visible=true}else{if(aA&&not_too_many){at.animate=true}}}aE=aG;if(aG>A.nav.minor_width){A.nav.minor_width=aG}if(aG<A.nav.minor_left){A.nav.minor_left=aG}}if(at.animate){VMM.Lib.animate(au,A.duration/2,A.ease,{opacity:at.opacity,left:at.pos})}else{VMM.Lib.css(au,"opacity",at.opacity);VMM.Lib.css(au,"left",aG)}}A.nav.constraint.right_min=-(A.nav.minor_width)+(A.width);A.nav.constraint.right=A.nav.constraint.right_min+(A.width/2);VMM.Lib.css(j,"left",A.nav.minor_left-(A.width)/2);VMM.Lib.width(j,(A.nav.minor_width)+(A.width)+Math.abs(A.nav.minor_left))}function E(ax,at,au){var aF=0,aw=true,aB=0,az=0,aC,av,aA,aG=Math.ceil(ax.number)+2,aD={flag:false,offset:0},aE=0;VMM.attachElement(au,"");ax.date=new Date(G[0].startdate.getFullYear(),0,1,0,0,0);aC=ax.date.getTimezoneOffset();for(aE=0;aE<aG;aE++){trace(ax.type);var ay=false,aH={element:VMM.appendAndGetElement(au,"<div>",ax.classname),date:new Date(G[0].startdate.getFullYear(),0,1,0,0,0),visible:false,date_string:"",type:ax.interval_type,relative_pos:0,is_detached:false,animation:{animate:false,pos:"",opacity:"100"}};if(ax.type=="eon"){if(aw){av=Math.floor(G[0].startdate.getFullYear()/500000000)*500000000}aH.date.setFullYear(av+(aF*500000000));ay=true}else{if(ax.type=="era"){if(aw){av=Math.floor(G[0].startdate.getFullYear()/100000000)*100000000}aH.date.setFullYear(av+(aF*100000000));ay=true}else{if(ax.type=="epoch"){if(aw){av=Math.floor(G[0].startdate.getFullYear()/10000000)*10000000}aH.date.setFullYear(av+(aF*10000000));ay=true}else{if(ax.type=="age"){if(aw){av=Math.floor(G[0].startdate.getFullYear()/1000000)*1000000}aH.date.setFullYear(av+(aF*1000000));ay=true}else{if(ax.type=="millenium"){if(aw){av=Math.floor(G[0].startdate.getFullYear()/1000)*1000}aH.date.setFullYear(av+(aF*1000));ay=true}else{if(ax.type=="century"){if(aw){av=Math.floor(G[0].startdate.getFullYear()/100)*100}aH.date.setFullYear(av+(aF*100));ay=true}else{if(ax.type=="decade"){if(aw){av=Math.floor(G[0].startdate.getFullYear()/10)*10}aH.date.setFullYear(av+(aF*10));ay=true}else{if(ax.type=="year"){if(aw){av=G[0].startdate.getFullYear()}aH.date.setFullYear(av+aF);ay=true}else{if(ax.type=="month"){if(aw){av=G[0].startdate.getMonth()}aH.date.setMonth(av+aF)}else{if(ax.type=="week"){if(aw){av=G[0].startdate.getMonth()}aH.date.setMonth(G[0].startdate.getMonth());aH.date.setDate(av+(aF*7))}else{if(ax.type=="day"){if(aw){av=G[0].startdate.getDate()}aH.date.setMonth(G[0].startdate.getMonth());aH.date.setDate(av+aF)}else{if(ax.type=="hour"){if(aw){av=G[0].startdate.getHours()}aH.date.setMonth(G[0].startdate.getMonth());aH.date.setDate(G[0].startdate.getDate());aH.date.setHours(av+aF)}else{if(ax.type=="minute"){if(aw){av=G[0].startdate.getMinutes()}aH.date.setMonth(G[0].startdate.getMonth());aH.date.setDate(G[0].startdate.getDate());aH.date.setHours(G[0].startdate.getHours());aH.date.setMinutes(av+aF)}else{if(ax.type=="second"){if(aw){av=G[0].startdate.getSeconds()}aH.date.setMonth(G[0].startdate.getMonth());aH.date.setDate(G[0].startdate.getDate());aH.date.setHours(G[0].startdate.getHours());aH.date.setMinutes(G[0].startdate.getMinutes());aH.date.setSeconds(av+aF)}else{if(ax.type=="millisecond"){if(aw){av=G[0].startdate.getMilliseconds()}aH.date.setMonth(G[0].startdate.getMonth());aH.date.setDate(G[0].startdate.getDate());aH.date.setHours(G[0].startdate.getHours());aH.date.setMinutes(G[0].startdate.getMinutes());aH.date.setSeconds(G[0].startdate.getSeconds());aH.date.setMilliseconds(av+aF)}}}}}}}}}}}}}}}if(VMM.Browser.browser=="Firefox"){if(aH.date.getFullYear()=="1970"&&aH.date.getTimezoneOffset()!=aC){trace("FIREFOX 1970 TIMEZONE OFFSET "+aH.date.getTimezoneOffset()+" SHOULD BE "+aC);trace(ax.type+" "+ax.date);aD.offset=(aH.date.getTimezoneOffset()/60);aD.flag=true;aH.date.setHours(aH.date.getHours()+aD.offset)}else{if(aD.flag){aD.flag=false;aH.date.setHours(aH.date.getHours()+aD.offset);if(ay){aD.flag=true}}}}if(ay){if(aH.date.getFullYear()<0){aH.date_string=Math.abs(aH.date.getFullYear()).toString()+" B.C."}else{aH.date_string=aH.date.getFullYear()}}else{aH.date_string=VMM.Date.prettyDate(aH.date,true)}aF=aF+1;aw=false;aH.relative_pos=ai(N,aH.date);aB=aH.relative_pos.begin;if(aH.relative_pos.begin>az){az=aH.relative_pos.begin}VMM.appendElement(aH.element,aH.date_string);VMM.Lib.css(aH.element,"text-indent",-(VMM.Lib.width(aH.element)/2));VMM.Lib.css(aH.element,"opacity","0");at.push(aH)}VMM.Lib.width(j,az);af(au,at)}function t(){var at=0,au=0;VMM.attachElement(T,"");k=VMM.appendAndGetElement(T,"<div>","timenav");a=VMM.appendAndGetElement(k,"<div>","content");c=VMM.appendAndGetElement(k,"<div>","time");h=VMM.appendAndGetElement(c,"<div>","time-interval-minor");j=VMM.appendAndGetElement(h,"<div>","minor");g=VMM.appendAndGetElement(c,"<div>","time-interval-major");e=VMM.appendAndGetElement(c,"<div>","time-interval");d=VMM.appendAndGetElement(T,"<div>","timenav-background");m=VMM.appendAndGetElement(d,"<div>","timenav-line");l=VMM.appendAndGetElement(d,"<div>","timenav-indicator");f=VMM.appendAndGetElement(d,"<div>","timenav-interval-background","<div class='top-highlight'></div>");n=VMM.appendAndGetElement(T,"<div>","vco-toolbar");v();w();u();z();ag(false);ae();af(e,O,false,true);af(g,S);if(A.start_page){$backhome=VMM.appendAndGetElement(n,"<div>","back-home","<div class='icon'></div>");VMM.bindEvent(".back-home",V,"click");VMM.Lib.attribute($backhome,"title",VMM.master_config.language.messages.return_to_title);VMM.Lib.attribute($backhome,"rel","tooltip")}b=new VMM.DragSlider;b.createPanel(T,k,A.nav.constraint,A.touch);if(A.touch&&A.start_page){VMM.Lib.addClass(n,"touch");VMM.Lib.css(n,"top",55);VMM.Lib.css(n,"left",10)}else{if(A.start_page){VMM.Lib.css(n,"top",27)}o=VMM.appendAndGetElement(n,"<div>","zoom-in","<div class='icon'></div>");p=VMM.appendAndGetElement(n,"<div>","zoom-out","<div class='icon'></div>");VMM.bindEvent(o,ab,"click");VMM.bindEvent(p,ac,"click");VMM.Lib.attribute(o,"title",VMM.master_config.language.messages.expand_timeline);VMM.Lib.attribute(o,"rel","tooltip");VMM.Lib.attribute(p,"title",VMM.master_config.language.messages.contract_timeline);VMM.Lib.attribute(p,"rel","tooltip");n.tooltip({selector:"div[rel=tooltip]",placement:"right"});VMM.bindEvent(T,Z,"DOMMouseScroll");VMM.bindEvent(T,Z,"mousewheel")}if(A.nav.zoom.adjust!=0){if(A.nav.zoom.adjust<0){for(at=0;at<Math.abs(A.nav.zoom.adjust);at++){ac()}}else{for(au=0;au<A.nav.zoom.adjust;au++){ab()}}}q=true;ak(true);VMM.fireEvent(T,"LOADED")}function v(){var at=0,au=0;aq=L((G[G.length-1].enddate)-(G[0].startdate),true);trace(aq);y();if(aq.centuries>G.length/A.nav.density){N=P.century;R=P.millenium;Q=P.decade}else{if(aq.decades>G.length/A.nav.density){N=P.decade;R=P.century;Q=P.year}else{if(aq.years>G.length/A.nav.density){N=P.year;R=P.decade;Q=P.month}else{if(aq.months>G.length/A.nav.density){N=P.month;R=P.year;Q=P.day}else{if(aq.days>G.length/A.nav.density){N=P.day;R=P.month;Q=P.hour}else{if(aq.hours>G.length/A.nav.density){N=P.hour;R=P.day;Q=P.minute}else{if(aq.minutes>G.length/A.nav.density){N=P.minute;R=P.hour;Q=P.second}else{if(aq.seconds>G.length/A.nav.density){N=P.second;R=P.minute;Q=P.second}else{trace("NO IDEA WHAT THE TYPE SHOULD BE");N=P.day;R=P.month;Q=P.hour}}}}}}}}trace("INTERVAL TYPE: "+N.type);trace("INTERVAL MAJOR TYPE: "+R.type);E(N,O,e);E(R,S,g);for(at=0;at<O.length;at++){for(au=0;au<S.length;au++){if(O[at].date_string==S[au].date_string){VMM.attachElement(O[at].element,"")}}}}function w(){var aH=2,aF=0,aI=0,aC=0,aD=0,aE=0;U=[];I=[];for(aC=0;aC<G.length;aC++){var at,aw,au,av,ax,ay,az,aA="",aB=false;at=VMM.appendAndGetElement(a,"<div>","marker");aw=VMM.appendAndGetElement(at,"<div>","flag");au=VMM.appendAndGetElement(aw,"<div>","flag-content");av=VMM.appendAndGetElement(at,"<div>","dot");ax=VMM.appendAndGetElement(at,"<div>","line");ay=VMM.appendAndGetElement(ax,"<div>","event-line");_marker_relative_pos=ai(N,G[aC].startdate,G[aC].enddate);_marker_thumb="";if(G[aC].asset!=null&&G[aC].asset!=""){VMM.appendElement(au,VMM.MediaElement.thumbnail(G[aC].asset,24,24,G[aC].uniqueid))}else{VMM.appendElement(au,"<div style='margin-right:7px;height:50px;width:2px;float:left;'></div>")}if(G[aC].title==""||G[aC].title==" "){trace("TITLE NOTHING");if(typeof G[aC].slug!="undefined"&&G[aC].slug!=""){trace("SLUG");aA=VMM.Util.untagify(G[aC].slug);aB=true}else{var aG=VMM.MediaType(G[aC].asset.media);if(aG.type=="quote"||aG.type=="unknown"){aA=VMM.Util.untagify(aG.id);aB=true}else{aB=false}}}else{if(G[aC].title!=""||G[aC].title!=" "){trace(G[aC].title);aA=VMM.Util.untagify(G[aC].title);aB=true}else{trace("TITLE SLUG NOT FOUND "+G[aC].slug)}}if(aB){VMM.appendElement(au,"<h3>"+aA+"</h3>")}else{VMM.appendElement(au,"<h3>"+aA+"</h3>");VMM.appendElement(au,"<h3 id='marker_content_"+G[aC].uniqueid+"'>"+aA+"</h3>")}VMM.Lib.attr(at,"id",("marker_"+G[aC].uniqueid).toString());VMM.bindEvent(aw,X,"",{number:aC});VMM.bindEvent(aw,Y,"mouseenter mouseleave",{number:aC,elem:aw});az={marker:at,flag:aw,lineevent:ay,type:"marker",full:true,relative_pos:_marker_relative_pos,tag:G[aC].tag,pos_left:0};if(G[aC].type=="start"){trace("BUILD MARKER HAS START PAGE");A.start_page=true;az.type="start"}if(G[aC].type=="storify"){az.type="storify"}if(G[aC].tag){am.push(G[aC].tag)}U.push(az)}am=VMM.Util.deDupeArray(am);if(am.length>3){A.nav.rows.current=A.nav.rows.half}else{A.nav.rows.current=A.nav.rows.full}for(aD=0;aD<am.length;aD++){if(aD<A.nav.rows.current.length){var aJ=VMM.appendAndGetElement(d,"<div>","timenav-tag");VMM.Lib.addClass(aJ,"timenav-tag-row-"+(aD+1));if(am.length>3){VMM.Lib.addClass(aJ,"timenav-tag-size-half")}else{VMM.Lib.addClass(aJ,"timenav-tag-size-full")}VMM.appendElement(aJ,"<div><h3>"+am[aD]+"</h3></div>")}}if(am.length>3){for(aE=0;aE<U.length;aE++){VMM.Lib.addClass(U[aE].flag,"flag-small");U[aE].full=false}}}function u(){var ay=6,at=0,ax=0;for(ax=0;ax<J.length;ax++){var av={content:VMM.appendAndGetElement(a,"<div>","era"),text_content:VMM.appendAndGetElement(e,"<div>","era"),startdate:VMM.Date.parse(J[ax].startDate),enddate:VMM.Date.parse(J[ax].endDate),title:J[ax].headline,uniqueid:VMM.Util.unique_ID(6),tag:"",relative_pos:""},az=VMM.Date.prettyDate(av.startdate),au=VMM.Date.prettyDate(av.enddate),aw="<div>&nbsp;</div>";if(typeof J[ax].tag!="undefined"){av.tag=J[ax].tag}av.relative_pos=ai(N,av.startdate,av.enddate);VMM.Lib.attr(av.content,"id",av.uniqueid);VMM.Lib.attr(av.text_content,"id",av.uniqueid+"_text");VMM.Lib.addClass(av.content,"era"+(at+1));VMM.Lib.addClass(av.text_content,"era"+(at+1));if(at<ay){at++}else{at=0}VMM.appendElement(av.content,aw);VMM.appendElement(av.text_content,VMM.Util.unlinkify(av.title));I.push(av)}}}}if(typeof VMM.Timeline!=="undefined"&&typeof VMM.Timeline.DataObj=="undefined"){VMM.Timeline.DataObj={data_obj:{},model_array:[],getData:function(a){VMM.Timeline.DataObj.data_obj={};VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Timeline.Config.language.messages.loading_timeline);if(type.of(a)=="object"){trace("DATA SOURCE: JSON OBJECT");VMM.Timeline.DataObj.parseJSON(a)}else{if(type.of(a)=="string"){if(a.match("%23")){trace("DATA SOURCE: TWITTER SEARCH");VMM.Timeline.DataObj.model.tweets.getData("%23medill")}else{if(a.match("spreadsheet")){trace("DATA SOURCE: GOOGLE SPREADSHEET");VMM.Timeline.DataObj.model.googlespreadsheet.getData(a)}else{if(a.match("storify.com")){trace("DATA SOURCE: STORIFY");VMM.Timeline.DataObj.model.storify.getData(a)}else{if(a.match(".jsonp")){trace("DATA SOURCE: JSONP");LoadLib.js(a,VMM.Timeline.DataObj.onJSONPLoaded)}else{trace("DATA SOURCE: JSON");var b="";if(a.indexOf("?")>-1){b=a+"&callback=onJSONP_Data"}else{b=a+"?callback=onJSONP_Data"}VMM.getJSON(b,VMM.Timeline.DataObj.parseJSON)}}}}}else{if(type.of(a)=="html"){trace("DATA SOURCE: HTML");VMM.Timeline.DataObj.parseHTML(a)}else{trace("DATA SOURCE: UNKNOWN")}}}},onJSONPLoaded:function(){trace("JSONP IS LOADED");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,storyjs_jsonp_data)},parseHTML:function(b){trace("parseHTML");trace("WARNING: THIS IS STILL ALPHA AND WILL NOT WORK WITH ID's other than #timeline");var a=VMM.Timeline.DataObj.data_template_obj;if(VMM.Lib.find("#timeline section","time")[0]){a.timeline.startDate=VMM.Lib.html(VMM.Lib.find("#timeline section","time")[0]);a.timeline.headline=VMM.Lib.html(VMM.Lib.find("#timeline section","h2"));a.timeline.text=VMM.Lib.html(VMM.Lib.find("#timeline section","article"));var c=false;if(VMM.Lib.find("#timeline section","figure img").length!=0){c=true;a.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure img"),"src")}else{if(VMM.Lib.find("#timeline section","figure a").length!=0){c=true;a.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure a"),"href")}else{}}if(c){if(VMM.Lib.find("#timeline section","cite").length!=0){a.timeline.asset.credit=VMM.Lib.html(VMM.Lib.find("#timeline section","cite"))}if(VMM.Lib.find(this,"figcaption").length!=0){a.timeline.asset.caption=VMM.Lib.html(VMM.Lib.find("#timeline section","figcaption"))}}}VMM.Lib.each("#timeline li",function(g,e){var h=false;var d={type:"default",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"};if(VMM.Lib.find(this,"time")!=0){h=true;d.startDate=VMM.Lib.html(VMM.Lib.find(this,"time")[0]);if(VMM.Lib.find(this,"time")[1]){d.endDate=VMM.Lib.html(VMM.Lib.find(this,"time")[1])}d.headline=VMM.Lib.html(VMM.Lib.find(this,"h3"));d.text=VMM.Lib.html(VMM.Lib.find(this,"article"));var f=false;if(VMM.Lib.find(this,"figure img").length!=0){f=true;d.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure img"),"src")}else{if(VMM.Lib.find(this,"figure a").length!=0){f=true;d.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure a"),"href")}else{}}if(f){if(VMM.Lib.find(this,"cite").length!=0){d.asset.credit=VMM.Lib.html(VMM.Lib.find(this,"cite"))}if(VMM.Lib.find(this,"figcaption").length!=0){d.asset.caption=VMM.Lib.html(VMM.Lib.find(this,"figcaption"))}}trace(d);a.timeline.date.push(d)}});VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)},parseJSON:function(a){trace("parseJSON");if(a.timeline.type=="default"){trace("DATA SOURCE: JSON STANDARD TIMELINE");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)}else{if(a.timeline.type=="twitter"){trace("DATA SOURCE: JSON TWEETS");VMM.Timeline.DataObj.model_Tweets.buildData(a)}else{trace("DATA SOURCE: UNKNOWN JSON");trace(type.of(a.timeline))}}},model:{googlespreadsheet:{getData:function(c){var a,b,h,g,e,f=0;b=VMM.Util.getUrlVars(c)["key"];h=VMM.Util.getUrlVars(c)["worksheet"];if(typeof h=="undefined"){h="od6"}g="https://spreadsheets.google.com/feeds/list/"+b+"/"+h+"/public/values?alt=json";e=setTimeout(function(){trace("Google Docs timeout "+g);trace(g);if(f<3){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+f);f++;a.abort();d()}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")}},16000);function d(){a=VMM.getJSON(g,function(j){clearTimeout(e);VMM.Timeline.DataObj.model.googlespreadsheet.buildData(j)}).error(function(k,l,j){trace("Google Docs ERROR");trace("Google Docs ERROR: "+l+" "+k.responseText)}).success(function(j){clearTimeout(e)})}d()},buildData:function(a){var b=VMM.Timeline.DataObj.data_template_obj,k=false;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Google Doc Data");function h(d){if(typeof d!="undefined"){return d.$t}else{return""}}if(typeof a.feed.entry!="undefined"){k=true;for(var j=0;j<a.feed.entry.length;j++){var e=a.feed.entry[j],f="";if(typeof e.gsx$type!="undefined"){f=e.gsx$type.$t}else{if(typeof e.gsx$titleslide!="undefined"){f=e.gsx$titleslide.$t}}if(f.match("start")||f.match("title")){b.timeline.startDate=h(e.gsx$startdate);b.timeline.headline=h(e.gsx$headline);b.timeline.asset.media=h(e.gsx$media);b.timeline.asset.caption=h(e.gsx$mediacaption);b.timeline.asset.credit=h(e.gsx$mediacredit);b.timeline.text=h(e.gsx$text);b.timeline.type="google spreadsheet"}else{if(f.match("era")){var g={startDate:h(e.gsx$startdate),endDate:h(e.gsx$enddate),headline:h(e.gsx$headline),text:h(e.gsx$text),tag:h(e.gsx$tag)};b.timeline.era.push(g)}else{var c={type:"google spreadsheet",startDate:h(e.gsx$startdate),endDate:h(e.gsx$enddate),headline:h(e.gsx$headline),text:h(e.gsx$text),tag:h(e.gsx$tag),asset:{media:h(e.gsx$media),credit:h(e.gsx$mediacredit),caption:h(e.gsx$mediacaption),thumbnail:h(e.gsx$mediathumbnail)}};b.timeline.date.push(c)}}}}else{}if(k){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,b)}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading+" Google Doc Data (cells)");trace("There may be too many entries. Still trying to load data. Now trying to load cells to avoid Googles limitation on cells");VMM.Timeline.DataObj.model.googlespreadsheet.getDataCells(a.feed.link[0].href)}},getDataCells:function(c){var a,b,g,e,f=0;b=VMM.Util.getUrlVars(c)["key"];g="https://spreadsheets.google.com/feeds/cells/"+b+"/od6/public/values?alt=json";e=setTimeout(function(){trace("Google Docs timeout "+g);trace(g);if(f<3){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+f);f++;a.abort();d()}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")}},16000);function d(){a=VMM.getJSON(g,function(h){clearTimeout(e);VMM.Timeline.DataObj.model.googlespreadsheet.buildDataCells(h)}).error(function(j,k,h){trace("Google Docs ERROR");trace("Google Docs ERROR: "+k+" "+j.responseText)}).success(function(h){clearTimeout(e)})}d()},buildDataCells:function(e){var f=VMM.Timeline.DataObj.data_template_obj,o=false,b=["timeline"],q=[],r=0,n=0,p=0;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading_timeline+" Parsing Google Doc Data (cells)");function m(d){if(typeof d!="undefined"){return d.$t}else{return""}}if(typeof e.feed.entry!="undefined"){o=true;for(n=0;n<e.feed.entry.length;n++){var h=e.feed.entry[n];if(parseInt(h.gs$cell.row)>r){r=parseInt(h.gs$cell.row)}}for(var n=0;n<r+1;n++){var g={type:"",startDate:"",endDate:"",headline:"",text:"",tag:"",asset:{media:"",credit:"",caption:"",thumbnail:""}};q.push(g)}for(n=0;n<e.feed.entry.length;n++){var h=e.feed.entry[n],j="",c="",a={content:m(h.gs$cell),col:h.gs$cell.col,row:h.gs$cell.row,name:""};if(a.row==1){if(a.content=="Start Date"){c="startDate"}else{if(a.content=="End Date"){c="endDate"}else{if(a.content=="Headline"){c="headline"}else{if(a.content=="Text"){c="text"}else{if(a.content=="Media"){c="media"}else{if(a.content=="Media Credit"){c="credit"}else{if(a.content=="Media Caption"){c="caption"}else{if(a.content=="Media Thumbnail"){c="thumbnail"}else{if(a.content=="Type"){c="type"}else{if(a.content=="Tag"){c="tag"}}}}}}}}}}b.push(c)}else{a.name=b[a.col];q[a.row][a.name]=a.content}}for(n=0;n<q.length;n++){var g=q[n];if(g.type.match("start")||g.type.match("title")){f.timeline.startDate=g.startDate;f.timeline.headline=g.headline;f.timeline.asset.media=g.media;f.timeline.asset.caption=g.caption;f.timeline.asset.credit=g.credit;f.timeline.text=g.text;f.timeline.type="google spreadsheet"}else{if(g.type.match("era")){var l={startDate:g.startDate,endDate:g.endDate,headline:g.headline,text:g.text,tag:g.tag};f.timeline.era.push(l)}else{var g={type:"google spreadsheet",startDate:g.startDate,endDate:g.endDate,headline:g.headline,text:g.text,tag:g.tag,asset:{media:g.media,credit:g.credit,caption:g.caption,thumbnail:g.thumbnail}};f.timeline.date.push(g)}}}}if(o){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,f)}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Unable to load Google Doc data source")}}},storify:{getData:function(b){var a,d,c;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Loading Storify...");a=b.split("storify.com/")[1];d="http://api.storify.com/v1/stories/"+a+"?per_page=300&callback=?";c=setTimeout(function(){trace("STORIFY timeout");VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Storify is not responding")},6000);VMM.getJSON(d,VMM.Timeline.DataObj.model.storify.buildData).error(function(f,g,e){trace("STORIFY error");trace("STORIFY ERROR: "+g+" "+f.responseText)}).success(function(e){clearTimeout(c)})},buildData:function(e){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Data");var a=VMM.Timeline.DataObj.data_template_obj;a.timeline.startDate=new Date(e.content.date.created);a.timeline.headline=e.content.title;trace(e);var o="";var m=e.content.author.username;var n="";if(typeof e.content.author.name!="undefined"){m=e.content.author.name;n=e.content.author.username+"&nbsp;"}if(typeof e.content.description!="undefined"&&e.content.description!=null){o+=e.content.description}o+="<div class='storify'>";o+="<div class='vcard author'><a class='screen-name url' href='"+e.content.author.permalink+"' target='_blank'>";o+="<span class='avatar'><img src='"+e.content.author.avatar+"' style='max-width: 32px; max-height: 32px;'></span>";o+="<span class='fn'>"+m+"</span>";o+="<span class='nickname'>"+n+"<span class='thumbnail-inline'></span></span>";o+="</a>";o+="</div>";o+="</div>";a.timeline.text=o;a.timeline.asset.media=e.content.thumbnail;a.timeline.type="storify";for(var k=0;k<e.content.elements.length;k++){var j=e.content.elements[k];var l=false;var f=new Date(j.posted_at);trace(j.type);var b={type:"storify",startDate:j.posted_at,endDate:j.posted_at,headline:" ",slug:"",text:"",asset:{media:"",credit:"",caption:""}};if(j.type=="image"){if(typeof j.source.name!="undefined"){if(j.source.name=="flickr"){b.asset.media="http://flickr.com/photos/"+j.meta.pathalias+"/"+j.meta.id+"/";b.asset.credit="<a href='"+b.asset.media+"'>"+j.attribution.name+"</a>";b.asset.credit+=" on <a href='"+j.source.href+"'>"+j.source.name+"</a>"}else{if(j.source.name=="instagram"){b.asset.media=j.permalink;b.asset.credit="<a href='"+j.permalink+"'>"+j.attribution.name+"</a>";b.asset.credit+=" on <a href='"+j.source.href+"'>"+j.source.name+"</a>"}else{b.asset.credit="<a href='"+j.permalink+"'>"+j.attribution.name+"</a>";if(typeof j.source.href!="undefined"){b.asset.credit+=" on <a href='"+j.source.href+"'>"+j.source.name+"</a>"}b.asset.media=j.data.image.src}}}else{b.asset.credit="<a href='"+j.permalink+"'>"+j.attribution.name+"</a>";b.asset.media=j.data.image.src}b.slug=j.attribution.name;if(typeof j.data.image.caption!="undefined"){if(j.data.image.caption!="undefined"){b.asset.caption=j.data.image.caption;b.slug=j.data.image.caption}}}else{if(j.type=="quote"){if(j.permalink.match("twitter")){b.asset.media=j.permalink;b.slug=VMM.Util.untagify(j.data.quote.text)}else{if(j.permalink.match("storify")){l=true;b.asset.media="<blockquote>"+j.data.quote.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</blockquote>"}}}else{if(j.type=="link"){b.headline=j.data.link.title;b.text=j.data.link.description;if(j.data.link.thumbnail!="undefined"&&j.data.link.thumbnail!=""){b.asset.media=j.data.link.thumbnail}else{b.asset.media=j.permalink}b.asset.caption="<a href='"+j.permalink+"' target='_blank'>"+j.data.link.title+"</a>";b.slug=j.data.link.title}else{if(j.type=="text"){if(j.permalink.match("storify")){l=true;var g=e.content.author.username;var h="";if(typeof j.attribution.name!="undefined"){m=j.attribution.name;n=j.attribution.username+"&nbsp;"}var c="<div class='storify'>";c+="<blockquote><p>"+j.data.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</p></blockquote>";c+="<div class='vcard author'><a class='screen-name url' href='"+j.attribution.href+"' target='_blank'>";c+="<span class='avatar'><img src='"+j.attribution.thumbnail+"' style='max-width: 32px; max-height: 32px;'></span>";c+="<span class='fn'>"+m+"</span>";c+="<span class='nickname'>"+n+"<span class='thumbnail-inline'></span></span>";c+="</a></div></div>";b.text=c;if((k+1)>=e.content.elements.length){b.startDate=e.content.elements[k-1].posted_at}else{if(e.content.elements[k+1].type=="text"&&e.content.elements[k+1].permalink.match("storify")){if((k+2)>=e.content.elements.length){b.startDate=e.content.elements[k-1].posted_at}else{if(e.content.elements[k+2].type=="text"&&e.content.elements[k+2].permalink.match("storify")){if((k+3)>=e.content.elements.length){b.startDate=e.content.elements[k-1].posted_at}else{if(e.content.elements[k+3].type=="text"&&e.content.elements[k+3].permalink.match("storify")){b.startDate=e.content.elements[k-1].posted_at}else{trace("LEVEL 3");b.startDate=e.content.elements[k+3].posted_at}}}else{trace("LEVEL 2");b.startDate=e.content.elements[k+2].posted_at}}}else{trace("LEVEL 1");b.startDate=e.content.elements[k+1].posted_at}}b.endDate=b.startDate}}else{if(j.type=="video"){b.headline=j.data.video.title;b.asset.caption=j.data.video.description;b.asset.caption=j.source.username;b.asset.media=j.data.video.src}else{trace("NO MATCH ");trace(j)}}}}}if(l){b.slug=VMM.Util.untagify(j.data.text)}a.timeline.date.push(b)}VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)}},tweets:{type:"twitter",buildData:function(a){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED");VMM.ExternalAPI.twitter.getTweets(a.timeline.tweets)},getData:function(a){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED");VMM.ExternalAPI.twitter.getTweetSearch(a)},onTwitterDataReady:function(f,c){var a=VMM.Timeline.DataObj.data_template_obj;for(var g=0;g<c.tweetdata.length;g++){var b={type:"tweets",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"};b.startDate=c.tweetdata[g].raw.created_at;if(type.of(c.tweetdata[g].raw.from_user_name)){b.headline=c.tweetdata[g].raw.from_user_name+" (<a href='https://twitter.com/"+c.tweetdata[g].raw.from_user+"'>@"+c.tweetdata[g].raw.from_user+"</a>)"}else{b.headline=c.tweetdata[g].raw.user.name+" (<a href='https://twitter.com/"+c.tweetdata[g].raw.user.screen_name+"'>@"+c.tweetdata[g].raw.user.screen_name+"</a>)"}b.asset.media=c.tweetdata[g].content;a.timeline.date.push(b)}VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)}}},data_template_obj:{timeline:{headline:"",description:"",asset:{media:"",credit:"",caption:""},date:[],era:[]}},date_obj:{startDate:"2012,2,2,11,30",headline:"",text:"",asset:{media:"http://youtu.be/vjVfu8-Wp6s",credit:"",caption:""},tags:"Optional"}}};